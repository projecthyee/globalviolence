---
title: "**P8105 Final Project: Determinants of Global Violence**"
author: "My An Huynh, Jeffrey Lin, Soo Min You, Hyun Kim, Malika Top"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
library(readxl)
library(countrycode)
library(tidyverse)

theme_set(theme_minimal() + 
  theme(plot.title = element_text(hjust = 0.5)))
```

# *Motivation*

Globally, violence undermines social and economic development, with its impacts 
being more pronounced in "developing" countries. Communities lacking adequate 
resources or experiencing systemic inequities are more vulnerable to various 
health challenges, including violence. Factors that influence health also play 
a role in shaping violence, which in turn affects determinants such as housing, 
education, transportation, and economic conditions. This project seeks to 
explore the factors driving serious assault, sexual violence, and intentional 
homicide worldwide from 2015 to 2023. 

We selected this time frame because it includes significant global events, 
including the COVID-19 pandemic and various conflicts, which have greatly 
influenced patterns of violence. Furthermore, even though there was a lot of missing 
data for 2023, we ultimately decided to include it in our analysis because of the
conflicts that defined this year. 

# *Related Work*

Conflict trends in 2023 revealed increasing threats to the state of global peace. 
New York Times (NYT) Journalist, Marc Lacey, titled NYT’s annual photojournalism 
review [“A Weary World”](https://www.nytimes.com/interactive/2023/world/year-in-pictures.html). 
Though 2024 comes to a close, the conflicts in Russia, Gaza, Ethiopia, and 
Sudan rage on, and more understanding of violence trends is needed. Tensions 
within and across countries have major implications for not just conflict 
prevention but also social and economic preservation which are often more fragile 
in vulnerable areas.

# *Initial Questions*

1. How can we best predict violence and homicide rates (i.e. what are its indicators)? 
2. How do rates of indicators compare across global regions and countries? 
3. How do rates of violence and homicide compare across global and regions and countries?
4. What categories of violent are most prevalent? 

# *Data*

## Source

Though there are many determinants and indicators of violence, we chose  
indicators and outcomes that were most interesting and came from one 
fairly consistent data source to try to limit discrepancies across
data collection methods. They came from the following sources:

* United Nations Development Program (UNDP): 
  - Human Development Index
* United Nations Office of Drugs and Crime (UNODC)
  - Corruption and Economic Crime
  - Criminal Justice Personnel
  - Human Trafficking
  - Intentional Homicide
  - Violent and Sexual Crimes
* World Bank
  - Gross Domestic Product (GDP)
  - Inflation Rate (Measured by Consumer Price Index)
  - Unemployment Rate
* World Health Organization (WHO)
  - Alcohol Consumption

Intentional homicide, and violent and sexual crimes were chosen as the outcome 
variable to quantify violence. 

* Intentional homicide:
  - counting unit: number of homicide victims per 100,000 population
  - classification:
    - situational context: organized crime, interpersonal (excluding 
    familial/intimate), socio-political
    - relationship to perpetrator: intimate partner, family member, friend, 
    colleague, etc.
    - mechanism: firearm, weapon, physical force

* Violent and sexual crimes:
  - counting unit: number of individual offences per 100,000 population
  - classification of offenses:
    - rape
    - serious assault
    - kidnapping
    - sexual violence
  - NOTE: some countries used other counting unit (a series of offenses to form 
  a case, or multiple cases to form an investigation)

## Scraping Method

The datasets were downloaded from the official websites of the sources above. 
The names of the files were also changed accordingly for clarity and to avoid 
confusion. For example, the alcohol consumption data file was renamed from 
"data.csv" to "alcohol_consumption.csv".

## Tidy EDA Data

For EDA, since we are interested in exploring the trends of global violence, 
we imported and tidied the datasets for our two outcome variables: homicide 
and violence. 

### Homicide Dataset
```{r}
homicide_visual_df = 
    read_excel(path = "data/unodc/intentional_homicide.xlsx",
               skip = 2) |>
  janitor::clean_names() |>
  filter(unit_of_measurement == "Rate per 100,000 population",
         indicator == "Victims of intentional homicide",
         category != "Total",
         sex != "Total",
         between(year, 2015, 2023)) |>
  select(country, region, category, sex, year, 
         homicide_rate = value) |>
  mutate(category = str_replace_all(category, 
                                    "^Intimate partner or family member.*", 
                                    "Intimate partner or family member"),
         category = str_replace_all(category, 
                                    "^Socio-political homicide.*", 
                                    "Socio-political homicide"))

write.csv(homicide_visual_df, file = "./data/homicide_visual.csv")
```

The tidied homicide dataset includes country, region, category of homicide 
victims, sex, year and victim rate of homicide. The dataset included data for 
both counts and rates per 100,000 people. Therefore, we filtered to choose rates 
per 100,000 people since it allows standardization for comparability by 
adjusting for differences in population size.

### Violence Dataset
```{r}
violence_visual_df = 
    read_excel(path = "data/unodc/violent_sexual_crime.xlsx",
               skip = 2) |>
  janitor::clean_names() |>
  filter(unit_of_measurement == "Rate per 100,000 population",
         between(year, 2015, 2023)) |>
  select(country, region, indicator, category, sex, year, 
         violence_rate = value) |>
  mutate(category = str_replace_all(category, 
                                    "^Sexual violence.*", 
                                    "Sexual violence"))

write.csv(violence_visual_df, file = "./data/violence_visual.csv")
```

The tidied violence dataset includes country, region, indicator, category of 
violence, sex, year and violence rate. The indicator includes different rates 
for violence (violent offences and victims) which are explored further in 
EDA. Rates per 100,000 people was chosen as the measurement since it takes into
account the differing populations across countries. 

## Tidy Regression Data

For regression, the datasets for all the chosen predictors and outcomes are 
tidied and merged for modeling process and analysis. 

### Function to Tidy Datasets
```{r pivot_tidy_function}
tidy_df = function(data, variable, pivot = FALSE, average = FALSE) {
  
  if(pivot) {
    data = data |>
      pivot_longer(cols = -iso3_code,
                   names_to = "year",
                   values_to = variable) |>
      janitor::clean_names()
  }
  
  data = data |>
    mutate(year = as.numeric(year),
           iso3_code = str_replace_all(iso3_code, "^GBR.*", "GBR"),
           iso3_code = str_replace_all(iso3_code, "^IRQ.*", "IRQ"),
           country = countrycode(iso3_code, origin = "iso3c",
                                 destination = "country.name",
                                 nomatch = NA, warn = FALSE)) |> 
    drop_na(country)
  
  if(average) {
    
    if("region" %in% colnames(data)) {
      data = data |>
        group_by( country, region, year) |>
        summarize(!!variable := mean(value))
    }
    
    else {
        data = data |>
          group_by(country, year) |>
          summarize(!!variable := mean(value))
    }
    
  }
  
  return(data)
  
}
```

We defined a function `tidy_df()`to pipe after importing each dataset to 
automatically tidy the datasets. The `countrycode()` function standardizes the 
country names of each dataset since some of the country names are represented 
inconsistently across dataset files. For example, South Korea was represented 
as "Korea (Republic of)" and "Korea, Rep." 

Moreover, for the countrycode() function, NA is returned if no matches are 
found and warnings are also suppressed by `nomatch = NA` and `warn = FALSE` 
respectively since some datasets include iso3 codes for entities that are not 
countries. For example, EUU represents the European Union; however, the 
`countrycode()` function only recognizes iso3 codes for countries and returns a 
warning, but we are interested in countries and regions. A boolean parameter 
called `pivot` was included to indicate if a dataset needs to be pivoted and 
subsequently perform `pivot_longer()`, since some datasets had years organized 
as different columns, where each column represented values for that year. 

Also, some of the datasets include rates for different categories. For example, 
the data for economic crime includes crime rates for fraud, burglary and more. 
Therefore, another boolean parameter called `average` was included to pass an 
option to group by and summarize rates across categories and genders of 
different datasets, in order to provide a standardized measure and reduce 
complexity for analysis.

### Economic Determinants
```{r tidy_econ_determinants, message = FALSE}
gdp_df = 
  read_excel(path = "data/worldbank/gdp.xls",
             sheet = "Data", skip = 3, na = "") |>
  select(iso3_code = 2, "2015":"2023") |>
  tidy_df("gdp", pivot = TRUE)

inflation_df = 
  read_excel(path = "data/worldbank/inflation_rate.xls", 
             sheet = "Data", skip = 3, na = "") |>
  select(iso3_code = 2, "2015":"2023") |>
  tidy_df("inflation_rate", pivot = TRUE)

unemployment_df =
  read_excel(path = "data/worldbank/unemployment_rate.xlsx",
             range = "A1:BP437", na = "..") |>
  rename_with(str_replace_all, pattern = " \\[.*", replacement = "") |>
  select(iso3_code = 4, "2013":"2023") |>
  tidy_df("unemployment_rate", pivot = TRUE)

human_develop_df =
  read_csv(file = "data/undp/human_development_index.csv", na = "") |>
  head(-11) |>
  rename_with(str_replace_all, pattern = "hdi_", replacement = "") |>
  select(iso3_code = 1, "2015":"2022") |>
  tidy_df("hdi", pivot = TRUE)
```

The following variables were identified as economic prdictors of violence: 

* `gdp`
* `inflation`
* `unemployment`
* `human development index`

The `pivot` parameter of the `tidy_df()` function was set to true for these 
datasets, since all of them had the different years as data columns, which 
needs to be pivoted accordingly. 

### Social Determinants
```{r import_social_determinants, message = FALSE}
econ_crime_df = 
  read_excel(path = "data/unodc/corruption_economic_crime.xlsx", skip = 2) |>
  janitor::clean_names() |>
  filter(unit_of_measurement == "Rate per 100,000 population") |>
  tidy_df("economic_crime_rate",  average = TRUE)

personnel_df =
  read_excel(path = "data/unodc/criminal_justice_personnel.xlsx", skip = 2) |>
  janitor::clean_names() |>
  filter(unit_of_measurement == "Rate per 100,000 population",
         indicator == "Criminal Justice Personnel", 
         sex == "Total") |>
  tidy_df("personnel_rate", average = TRUE)

trafficking_df =
  read_excel(path = "data/unodc/human_trafficking.xlsx", skip = 2) |>
  janitor::clean_names() |>
  filter(indicator == "Detected trafficking victims",
         category == "Total", 
         sex == "Total",
         age == "Total",
         txt_value != "<5") |>
  mutate(value = str_replace_all(txt_value, ",", ""),
         value = as.numeric(value)) |>
  select(iso3_code : region, year, trafficked_victims = value) |>
  tidy_df("trafficked_victims")

alcohol_df =
  read_csv(file = "data/who/alcohol_consumption.csv", na = "") |>
  janitor::clean_names() |>
  filter(dim1 == "Both sexes") |>
  select(iso3_code = spatial_dim_value_code, 
         year = period, 
         value = fact_value_numeric) |>
  tidy_df("alcohol_consumption_rate", average = TRUE)
```

The following variables were identified as social prdictors of violence: 

* `economic crime`
* `criminal justice personnel`
* `human trafficking`
* `alcohol`

The datasets for economic crimes and criminal justice personnel also provided 
data for both counts and rates per 100,000 people. Subsequently, we filtered to 
choose rates per 100,000 people for standardization and comparability. The 
human trafficking dataset provided data for number of human trafficking victims, 
instead of trafficking rates; the dataset also included a category for total 
number of trafficking victims, so the data was filtered for total category and 
neither the `pivot` nor `average` options were set to true in the `tidy_df()` 
function.

### Outcomes of Violence
```{r import_violence_outcomes, message = FALSE}
homicide_df = 
  read_excel(path = "data/unodc/intentional_homicide.xlsx", skip = 2) |>
  janitor::clean_names() |>
  filter(indicator == "Victims of intentional homicide",
         unit_of_measurement == "Rate per 100,000 population",
         dimension == "Total", 
         sex == "Total", 
         age == "Total") |>
  tidy_df("homicide_rate", average = TRUE)
  
violence_df = 
  read_excel(path = "data/unodc/violent_sexual_crime.xlsx", skip = 2) |>
  janitor::clean_names() |>
  filter(indicator == "Violent offences",
         unit_of_measurement == "Rate per 100,000 population") |>
  tidy_df("violence_rate", average = TRUE)
```

Unlike the tidied dataset for EDA, the datasets for homicide and violence had 
their respective rates averaged across category, since we are interested in 
the average rates of homicide victims and violent offences for regression 
analysis. 

### Merge Datasets
```{r merge_datasets, message = FALSE}
merged_violence_df =
  left_join(homicide_df, violence_df) |>
  left_join(gdp_df) |>
  left_join(inflation_df) |>
  left_join(unemployment_df) |>
  left_join(human_develop_df) |>
  left_join(econ_crime_df) |>
  left_join(personnel_df) |>
  left_join(trafficking_df) |>
  left_join(alcohol_df) |>
  mutate(country = as.factor(country),
         region = as.factor(region)) |>
  filter(between(year, 2015, 2023)) |>
  relocate(iso3_code) |>
  drop_na(violence_rate, homicide_rate)

head(merged_violence_df)
write.csv(merged_violence_df, file = "./data/merged_violence.csv")
```

The final merged dataset includes `r nrow(merged_violence_df)` rows and 
`r ncol(merged_violence_df)` columns, including iso3 codes, country, region, 
year, homicide rate, average violence offence rate, gdp, inflation rate, 
unemployment rate, average crime rate, criminal justice personnel rate, total, 
human trafficking rate and alcohol consumption rate as variables. There is a 
total of `r length(unique(pull(merged_violence_df, country)))` distinct 
countries. 

After merging the datasets, country and region were converted to categorical 
variables and the dataset was filtered for the years between 2015 and 2023, 
the period of our interest for analysis. Although the datasets were merged with 
matching country names tidied by the `countrycode()`, the iso3 codes were 
retained, since they are required for plotting maps which can be found under the 
shiny section of this website. 

# *Exploratory Data Analysis*

## Homicide Victims

### Global Trends of Homicide Victims
```{r message = FALSE}
homicide_visual_df |>
  group_by(region, sex, year) |>
  summarize(avg_homicide_rate = mean(homicide_rate)) |>
  ggplot(aes(y = avg_homicide_rate, x = year, color = sex)) +
  geom_smooth(se = FALSE) +
  facet_grid(~region) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Year",
       y = "Average Rate of Homicide Victims",
       title = "Homicide Victims Worldwide")
```

The Americas and Asia have significantly higher average homicide rate across 
years for male victims compared to the other regions. The average homicide rate 
between genders are not significant for Africa, Asia and Oceania. 

### Comparing the Americas and Asia
```{r message = FALSE, warning = FALSE}
homicide_visual_df |>
  filter(region %in% c("Asia", "Americas")) |>
  group_by(category, region) |>
  summarize(avg_homicide_rate = mean(homicide_rate)) |>
  ggplot(aes(y = avg_homicide_rate, x = region,
             fill = reorder(category, avg_homicide_rate))) +
  geom_col(position = "dodge", bin = 3.0) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Region",
       y = "Average Rate of Homicide Victims",
       title = "Homicide in America & Asia", 
       fill = "Category")
```

Further exploring homicide in Americas and Asia, the Americas have higher 
homicide rates for most categories compared to Asia. Homicides of perpetrator 
to victim relationship unknown has the largest homicide rate. Homicides of 
unknown types is next category with the highest homicide rate in the Americas. 

On the other hand, Asia has a significantly high homicide rate in 
socio-political homicide compared to the other categories,suggesting high 
casualties as a result of socio-political activities for countries in Asia. 
The other categories have a homicide rate lesser than 5 percent. 

### Breakdown of Homicide
```{r message = FALSE}
homicide_visual_df |>
  group_by(category, year) |>
  summarize(avg_homicide_rate = mean(homicide_rate)) |>
  ggplot(aes(y = avg_homicide_rate, x = as.factor(year), fill = 
               reorder(category, avg_homicide_rate))) +
  geom_bar(stat = "identity") + 
  labs(title = "Distribution of Homicide by Category",
       x = "Year",
       y = "Total Rate of Homicide Victims",
       fill = "Category")
```

Homicides of unknown types and perpetrator to victim relationship unknown are 
two highest proportions in the total homicide rate, indicating most homicides 
are committed by strangers or have no connection with the victims. Also, we can 
observe that homicide rates as a result of organized criminal groups or gangs 
and interpersonal homicide are the next significant proportions in homicide. 
The total homicide rate increases sharply from 2015 to 2017 compared to the 
other years possibly due to socioeconomic factors, such as economic instability. 


## Violence: Offences & Victims

### Global Trends of Violent Offences
```{r message = FALSE, fig.height = 10}
violence_visual_df |> 
  filter(indicator == "Violent offences") |> 
  group_by(category, year, region) |> 
  summarise(grp_mean_rate = mean(violence_rate)) |> 
  ggplot(aes(x = year, y = grp_mean_rate, color = category)) +
  geom_line() +
  facet_wrap(~region, ncol=2) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom") + 
  labs(title = "Violent Offences Worldwide",
       x = "Year", 
       y = "Average Rate of Violent Offences") +
  guides(color = guide_legend(nrow = 3))
```

Africa's most common violent offence category was serious assault, with the 
Americas trading off between serious assault and acts intended to induce fear 
or emotional distress. From 2015-2021 Oceania clearly has the highest rates of 
serious assault, but it drops severely in 2022. 

### Exploring Violent Offences
```{r message = FALSE, fig.height = 10, fig.width = 8}
violence_visual_df |>
  filter(indicator == "Violent offences") |>
  group_by(category, year, region) |> 
  summarise(avg_violence_rate = mean(violence_rate)) |> 
  mutate(category = fct_reorder(category, avg_violence_rate)) |>
  ggplot(aes(x = category, y = avg_violence_rate, fill = region)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~year, ncol=2) +
  theme(axis.text.x = element_text(angle = 80, hjust = 1),
        legend.position = "bottom") +
  labs(x = "Category", 
       y = "Average Rate of Violent Offences",
       title = "Violent Offences by Category Across Time") 
```

The plot above shows similar trends to the line graph above, but allows us to compare more closely
the rates for categories that are less visible such as sexual violence, where Oceania appears
to have the highest rates of as well. We see more clearly that with Oceania's drop in serious
assaults in 2022, Americas and Oceania have similar trends.  
 

### Victims of Sexual Violence
Even in 2024, it is still ever-important to discuss sexual violence crimes. 
Violence against women is a public health issue and any type of sexual violence 
is a violation of human rights, harming physical, mental, sexual, and reproductive 
health. We are interested in seeing more specifically trends in sexual violence 
across the years for regions with sufficient data. 

```{r message = FALSE}
violence_visual_df |>
  filter(indicator == "Victims of sexual violence",
         region != "Africa") |>
  group_by(region, sex, year) |>
  summarize(avg_victim_rate = mean(violence_rate)) |>
  ggplot(aes(y = avg_victim_rate, x = year, color = sex)) +
  geom_smooth(se = FALSE) +
  facet_grid(~region) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Year",
       y = "Average Rate of Sexual Violence Victims",
       title = "Sexual Violence Worldwide")
```

When exploring victim rate of sexual violence, we can see that in overall, 
there is a higher average victim rate for females; the largest disparity in 
victim rate between the genders can be observed in Oceania, where the rate for 
females have been sharply increasing over the years. The victim rate for the 
Americas and Europe has also been increasing, but steadily compared to Oceania 
over the years, while Asia has experienced a decline from 2019. Africa was not 
included because the data was either very small or missing for many countries 
in the region. 

### Investigating Sexual Violence
```{r message = FALSE}
violence_visual_df |>
  filter(indicator == "Victims of sexual violence",
         region != "Africa") |>
  group_by(category, sex, region) |>
  summarize(avg_victim_rate = mean(violence_rate)) |>
  ggplot(aes(y = avg_victim_rate, x = region, 
             fill = reorder(category, avg_victim_rate))) +
  geom_col(position = "dodge") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Region",
       y = "Average Rate of Sexual Violence Victims",
       fill = "Category",
       title = "Sexual Violence By Category Across Region")
```

Further exploring victims of sexual violence, except for perpetrator unknown to 
the victim, Oceania has a higher average victim rate of sexual violence for the 
all other categories compared to the other regions. Oceania, Europe and Americas 
have relationship of perpetrator is not known as the highest category for 
victim rate. Similar to homicide, the perpetrators are strangers or have no 
connection with the victims for most sexual violence. On the other hand, Asia 
has a significantly low average victim rate, having other perpetrator known to 
the victim as the category with the highest rate.

### Breakdown of Sexual Violence
```{r message = FALSE}
violence_visual_df |>
  filter(indicator == "Victims of sexual violence",
         region != "Africa") |>
  group_by(category, year) |>
  summarize(avg_victim_rate = mean(violence_rate)) |>
  ggplot(aes(y = avg_victim_rate, x = as.factor(year), 
             fill = reorder(category, avg_victim_rate))) +
  geom_bar(stat = "identity") + 
  labs(x = "Year",
       y = "Total Rate of Sexual Violence Victims",
       title = "Distribution of Sexual Violence by Category",
       fill = "Category")
```

Relationship to perpetrator is not known in the category with a significant 
proportion to total victim rate of sexual violence compared to the other 
categories across the years. The proportion of victim rates for the other three 
categories become approximately equal to each other from 2019. Specifically, 
the proportion for intimate partner or family member and perpetrator unknown to 
the victim increases over time.

## Global Prevalence of Violence

Across the time period from 2015 to 2023, the Americas consistently exhibited 
a significantly higher homicide rate compared to other regions. The difference 
in this region is pronounced, indicating a persistent and widespread issue with 
violent crime. The homicide rate in Asia is also notable. There was a rising 
trend in homicide rate from 2015 to 2021, but was followed by a sharp decrease 
in 2022. However, it should be noted that not all countries that reported 
homicide rate also reported the violence rate. 

The drop in 2022 may imply that there was a potential shift or improvement in 
the region, but it could also mean that there are some missing data in that 
year, leading a bias or misinterpretation. When examining violence rates, 
the Americas followed a similar trend to the homicide rate, with rates significantly 
higher than the other regions. This trend reflects the persistent issue of violence 
in the region, affecting not only homicide rates but also broader forms of violence. 
However, Oceania presented an extreme outlier in terms of victim rates of sexual 
violence, surpassing even the Americas.

Putting these results against our own knowledge, Oceania's rates seem higher
than expected. This raises the question of if higher rates mean more violent
countries or countries who just have reported more crimes. It is very important
to address that these outcome data are compiled by  UNODC but the data itself comes
from each nation's respective administrative registers, often managed by law enforcement
agencies. Additionally, UNODC comes by this data not through requirement but by the 
United Nations Survey of Crime Trends and Operations of Criminal Justice Systems (UN-CTS). 
This means that countries voluntarily supply their information. However, a safety-guard 
is that UNODC does check for consistency and coherence with other data sources. 


# *Regression*

```{r regression setup, include=FALSE}
library(glmnet)
library(leaps)
library(mgcv)
library(ggcorrplot)
library(modelr)
library(GGally)
set.seed(1)

merged_violence_df <- read_csv(
  file = "data/merged_violence.csv",
  col_select = c(2:15))
```

## Background
Our motivation for doing regression is to determine the significant predictors 
of the two measures of violence: (1) homicide victim rate and (2) violent offences rate. 

Global violence is a complex issue, depending on many factors, from political,
cultural, to economic. We aimed to choose predictors that reflect inequality which are
often related to social unrest and violence. Much numerical data exists for the economic indicators of a country
such as GDP, inflation and unemployment rate, and we also wanted to include HDI since that in itself
is a well-recognized global measurement. Intuitively, criminal activity is also related to violence,
so indicators for economic crime rate and criminal justice personnel were considered. Lastly, alcohol rate was included
because substance usage is often perceived to be correlated with violence. Subsequently, 
we aim to develop models that show which factors are the best predictors of homicide and violence rates. 

Given the plausible theoretical linkage between each of our included 
predictor variables and the outcome variables of interest, we seek to develop 
models that can determine which factors are most predictive of homicide and 
violence rate. 

We performed this analysis to uncover the extent to which 
different factors influence homicide rate and violence rate as outcomes.

## Functions for Fitting Data

### best_subset
```{r }
best_subset = function(predictor, outcome, criterion) {
  
  optimal_subset <- 
    leaps(x = predictor, y = outcome, nbest = 3, 
      method = criterion, names = names(predictor))
  
  if (criterion == "Cp") {
    optimal_criterion <- optimal_subset[[criterion]] %>% min()
    optimal_subset_idx <- optimal_subset[[criterion]] %>% which.min()
    
  } else {
    optimal_criterion <- optimal_subset[[criterion]] %>% max()
    optimal_subset_idx <- optimal_subset[[criterion]] %>% which.max()
  }
  
  return(list(Criterion = optimal_criterion , 
       Variable_Selection = optimal_subset$which[optimal_subset_idx,]))
  
}
```
This function serves as a wrapper around the leaps function. It performs 
best-subset variable selection and then prints out the optimal model diagnostic 
and the predictor variables included in the regression model.

### fit_glmnet
```{r }
fit_glmnet = function(df, alpha, outcome, lambda) {
  
  outcome_formula <- as.formula(paste(outcome, "~."))
  predictor <- model.matrix(outcome_formula, data = df)[,-1]
  predicted <- df %>% pull(outcome)
  
  model_fit <- 
    glmnet(predictor, predicted, lambda = lambda, alpha = alpha)
  
  model_cv <-
    cv.glmnet(predictor, predicted, lambda = lambda, alpha = alpha)
  
  lambda_opt = model_cv[["lambda.min"]]
  
  model_fit <-
    glmnet(predictor, predicted, lambda = lambda_opt, alpha = alpha)
  
  return(model_fit)
  
}
```
This function serves as a wrapper for the glmnet fitting processing and 
covers both the fitting and cross-validation process. It returns the glmnet 
object produced after fitting with optimal lambda value.

### rmse_glmnet
```{r }
rmse_glmnet = function(model, test, outcome) {
  outcome_formula <- as.formula(paste(outcome, "~."))
  predictor <- model.matrix(outcome_formula, data = test)[,-1]
  predictions <- predict.glmnet(model, model[["lambda"]], newx = predictor,
                               type = "response")
  
  predictions <- as.vector(predictions)
  observed <- test %>% 
    pull(outcome)
  
  return(caret::RMSE(predictions, observed))
  
}
```
This is a wrapper function for the glmnet prediction and evaluation process. 
Given a fitted glmnet model, a test dataset, and an outcome variable of 
interest, this function predicts the avlues in the test dataset and then 
calculates and returns the rmse. 


### check_model
```{r}
check_model = function(data, name) {
  
  resid_fit = 
    data |>
    ggplot(aes(y = resid, x = pred)) +
    geom_point() +
    geom_smooth(method = "lm") + 
    labs(title = paste("Residual vs. Fitted:", name),
         y = "Residual", 
         x = "Fitted Value")
  
  print(resid_fit)
  qqnorm(pull(data, resid), main = paste("QQ Plot: ", name))
  qqline(pull(data, resid), col = "red")
  
}
```
This is a plotting function to combine several different plot types that assess 
the assumptions of linear models.


## Descriptive Statistics

### Visualizations of Distributions
```{r distributions, fig.width = 20, fig.height = 20, warning = FALSE, message = FALSE, echo = FALSE}
merged_violence_df |>
  select(homicide_rate:alcohol_consumption_rate) |>
  ggpairs()
```

All variables are skewed right, except for HDI which is 
bimodal and slightly left-skewed. Hence, we decided to apply ln transformations 
and Box-Cox transformations to ensure normality of the data. 



### Data Transformations

#### Natural Log Transform
```{r ln-transform, fig.width = 20, fig.height = 20, warning = FALSE}
ln_transform = function(value) {
  return(log(abs(value)))
}

ln_df = 
  merged_violence_df |>
  mutate(across(c(homicide_rate:alcohol_consumption_rate), 
                ln_transform))

ln_df |>
  select(homicide_rate:alcohol_consumption_rate) |>
  ggpairs()

```

#### Box-Cox Transform
```{r boxcox, fig.width = 20, fig.height = 20, warning = FALSE}
boxcox_transform = function(value) {
  if (all(is.na(value))) {
    return(value) 
  }

  min_value = min(value, na.rm = TRUE) 
  if (min_value <= 0) {
    value = value + abs(min_value) + 0.00001  
  }

  if (length(unique(value)) == 1) {
    return(value) 
  }

  boxcox_result = MASS::boxcox(value ~ 1, plotit = FALSE)
  lambda = boxcox_result$x[which.max(boxcox_result$y)]  

  if(lambda != 0) {
    transformed_value = (value^lambda - 1) / lambda
  } else {
    transformed_value = log(value)
  }
  return(transformed_value)
}

boxcox_df = merged_violence_df |> 
  mutate(across(c(homicide_rate:alcohol_consumption_rate), 
                ~ boxcox_transform(.)))

boxcox_df |>
  select(homicide_rate:alcohol_consumption_rate) |>
  ggpairs()

```

Both natural log and boxcox transformations substantially normalized the distributions. 
Since boxcox resulted in more improved results as shown in the plots above, 
we decided to use the boxcox transformed data for regression. 

### Multicolliniearity Diagnostics

We used `cor()` to find the correlation between the eight predictors of 
homicide rate and violence. 

```{r }
cor_matrix = 
  cor(boxcox_df[, c("gdp", "inflation_rate", "unemployment_rate", "hdi",
                             "economic_crime_rate", "personnel_rate", "trafficked_victims", 
                             "alcohol_consumption_rate")], use = "pairwise.complete.obs")

ggcorrplot(cor_matrix, 
           method = "circle",  
           type = "lower",  
           lab = TRUE,        
           lab_size = 3,      
           colors = c("blue", "white", "red"), # Color scale (blue = negative, red = positive)
           title = "Correlation Heatmap"
)
```

There is moderate correlation between `hdi` and `alcohol_consumption_rate` (corr = 0.56), `hdi` and `economic_crime_rate` (corr = 0.57), and `gdp` and `trafficked_victims` (corr - 0.51). 

## Data Pre-Processing

### Define Lambda Range
```{r}
lambda = 10^(seq(-2, 2.75, 0.1))
```

### Approach to Pre-Processing Data

Prior to performing any model fitting, we split our initial dataset into 
separate homicide and violence datasets, each of which includes the outcome 
variable and all numeric predictor variables. Specific predictor and outcome 
dataframes, and an outcome matrix, are created for later use in linear models, 
as well as lasso.

#### Pre-Processing for Homicide
```{r}
homicide_df =
  boxcox_df |> 
  ungroup() |> 
  select(-violence_rate, -year, -country, -region, -iso3_code) |> 
  drop_na()

homicide_matrix <- model.matrix(homicide_rate ~., data = homicide_df)[,-1]

homicide_predictors <- homicide_df %>% 
  select(-homicide_rate)

homicide_outcome <- homicide_df %>% 
  pull(homicide_rate)
```

#### Pre-Processing for Violence
```{r }
violence_df =
  boxcox_df |> 
  ungroup() |> 
  select(-year, -homicide_rate, -country, -region, -iso3_code) |>
  drop_na()

violence_matrix <- model.matrix(violence_rate ~., data = violence_df)[,-1]
  
violence_predictors <- violence_df %>% 
  select(-violence_rate)

violence_outcome <- violence_df %>% 
  pull(violence_rate)

```

## Baseline MLR with Additive Effects

First, we decided to fit a baseline MLR with additive effects from all possible 
predictor variables to use as a point of reference for our modeling process. 
This step provides insight into which  
covariates contribute to the outcomes of interest. 

### Predict Homicide Rates
```{r }
baseline_MLR_hom <- lm(homicide_rate ~ gdp + inflation_rate + unemployment_rate +
                   hdi + economic_crime_rate + personnel_rate + trafficked_victims + 
                    alcohol_consumption_rate , data = homicide_df)

baseline_MLR_hom_fitted <- baseline_MLR_hom[["fitted.values"]]

baseline_MLR_hom %>% 
  broom::tidy() %>% 
  knitr::kable()
```
Results from baseline MLR show that that HDI, economic crime rate and personnel rate are significant predictors of homicide.

### Collinearity of Baseline Homicide Model 
```{r }
vif_baseline_hom_MLR <- car::vif(baseline_MLR_hom)
vif_baseline_hom_MLR %>% 
  tibble(
    variable = names(vif_baseline_hom_MLR),
    VIF = vif_baseline_hom_MLR
  ) %>% 
  select(variable, VIF) %>% 
  knitr::kable()

```

Results from VIF show that there is no serious multicollinearity issue (VIF < 5).

### Predict Violence Rates
```{r }
baseline_MLR_viol <- lm(violence_rate ~ gdp + inflation_rate + unemployment_rate +
                   hdi + economic_crime_rate + personnel_rate + trafficked_victims + 
                    alcohol_consumption_rate , data = violence_df)

baseline_MLR_viol_fitted <- baseline_MLR_viol[["fitted.values"]]

baseline_MLR_viol %>% 
  broom::tidy() %>% 
  knitr::kable()
```
Results from MLR show that `gdp`, `inflation_rate`, `unemployment_rate`, `hdi`, `economic_crime_rate`, and `alcohol_consumption_rate` are significant predictors of violence rate $\alpha$ = 0.01. 

### Collinearity of Baseline Violence Model
```{r }
vif_baseline_viol_MLR <- car::vif(baseline_MLR_viol)
vif_baseline_viol_MLR %>% 
  tibble(
    variable = names(vif_baseline_viol_MLR),
    VIF = vif_baseline_viol_MLR
  ) %>% 
  select(variable, VIF) %>% 
  knitr::kable()
```
Results from VIF show that there is no serious multicollinearity issue (VIF < 5).

## Lasso
We used lasso to as a feature selection tool to find the most important 
variables in predicting homicide rate and violence rate. 

### Predictors for Violence Rate
```{r }
lasso_violence_fit = 
  glmnet(violence_matrix, violence_outcome, lambda = lambda)

lasso_violence_cv = 
  cv.glmnet(violence_matrix, violence_outcome, lambda = lambda)

lambda_violence_opt = 
  lasso_violence_cv[["lambda.min"]]

lasso_violence_fit = 
  glmnet(violence_matrix, violence_outcome, lambda = lambda_violence_opt)

lasso_violence_fit |> 
  broom::tidy() |> 
  knitr::kable()

lasso_predict_violence <- 
  predict.glmnet(lasso_violence_fit, lambda_violence_opt, 
                 newx = violence_matrix, type = "response")
  
lasso_predict_violence <- as.vector(lasso_predict_violence)

lasso_violence_resid <- tibble(
  residuals = violence_outcome - lasso_predict_violence
)

```

The optimal lambda for violence rate is `r round(lambda_violence_opt, 2)`. 


### Predictors for Homicide Rate
```{r }
lasso_homicide_fit = 
  glmnet(homicide_matrix, homicide_outcome, lambda = lambda)

lasso_homicide_cv = 
  cv.glmnet(homicide_matrix, homicide_outcome, lambda = lambda)

lambda_homicide_opt = 
  lasso_homicide_cv[["lambda.min"]]

lasso_homicide_fit = 
  glmnet(homicide_matrix, homicide_outcome, lambda = lambda_homicide_opt)

lasso_homicide_fit |> 
  broom::tidy() |> 
  knitr::kable()

lasso_predict_homicide <- 
  predict.glmnet(lasso_homicide_fit, lambda_homicide_opt, 
                 newx = homicide_matrix, type = "response")
  
lasso_predict_homicide <- as.vector(lasso_predict_homicide)

lasso_homicide_resid <- tibble(
  residuals = homicide_outcome - lasso_predict_homicide
)

```

The optimal lambda for homicide rate is `r round(lambda_homicide_opt, 2)`.  

## Criterion-Based Procedure

### Best-Subset Regression for Violence 

#### Predict Violence Rate with R-Squared
```{r }
violence_best_subset_rsq <- 
  best_subset(predictor = violence_predictors, outcome = violence_outcome, 
              criterion = "adjr2")

violence_best_subset_rsq
```

#### Predict Violence Rate with Cp 
```{r }
violence_best_subset_Cp <- 
  best_subset(predictor = violence_predictors, outcome = violence_outcome, 
              criterion = "Cp")
violence_best_subset_Cp
```

#### Collinearity of Best-Subset Violence Model
```{r }
subset_violence_lm <- lm(violence_rate ~ gdp + inflation_rate + unemployment_rate + hdi + economic_crime_rate + personnel_rate + alcohol_consumption_rate, data = violence_df)
summary(subset_violence_lm)
subset_violence_fitted <- subset_violence_lm[["fitted.values"]]


vif_subset_violence_model <- car::vif(subset_violence_lm) 

vif_subset_violence_model %>% 
  tibble(
    variable = names(vif_subset_violence_model),
    VIF = vif_subset_violence_model
  ) %>% 
  select(variable, VIF) %>% 
  knitr::kable()
```
All variables have VIF value below 5, suggesting that there is no 
multi-colinearity concerns.

#### Interpretation

The results from both criterion-based procedures suggest that 
significant predictors for `violence_rate` are `gdp`, `inflation_rate`, 
`unemployment_rate`, `economic_crime_rate`, `personnel_rate`, `hdi` 
and `alcohol_consumption rate`, with a total of 7 predictors. 
This yields the most appropriate Cp value (6.94), which is approximately 
close to the number of predictors, and highest adjusted R-squared (0.46).

### Best Subset Regression for Homicide 

#### Predict Homicide Rate with R-Squared 
```{r }
homicide_best_subset_rsq <- 
  best_subset(predictor = homicide_predictors, outcome = homicide_outcome, 
              criterion = "adjr2")

homicide_best_subset_rsq
```

#### Predict Homicide Rate with Cp
```{r }
homicide_best_subset_Cp <- 
  best_subset(predictor = homicide_predictors, outcome = homicide_outcome, 
              criterion = "Cp")

homicide_best_subset_Cp
```

#### Collinearity of Best-Subset Homicide Model
```{r }
subset_homicide_lm <- lm(homicide_rate ~ unemployment_rate + hdi + 
                           economic_crime_rate + personnel_rate, 
                         data = homicide_df)
summary(subset_homicide_lm)
subset_homicide_fitted <- subset_homicide_lm[["fitted.values"]]


vif_subset_homicide_model <- car::vif(subset_homicide_lm)
vif_subset_homicide_model %>% 
  tibble(
    variable = names(vif_subset_homicide_model),
    VIF = vif_subset_homicide_model
  ) %>% 
  select(variable, VIF) %>% 
  knitr::kable()
```
All variables have VIF value below 5, suggesting that there is no 
multi-colinearity issue.


### Interpretation
For `homicide_rate`, the results are not as straightforward. 
The best model based on R-squared (0.57) is the model with `unemployment_rate`, `hdi`, `economic_crime_rate` and `personnel_rate` as predictors. Howeover, based on the Cp criterion (2.51), it's the model with `hdi`, `economic_crime_rate` and `personnel_rate`.

Subsequently, we will choose four predictors since it has a relatively high adjusted R-Squared (0.57) and we were interested in a model that explains more variation in violence rates. 

## Model Comparison

### Create Training and Testing Datasets
```{r}
cv_df_violence <- 
  modelr::crossv_mc(violence_df, 100)

cv_df_violence <- cv_df_violence %>% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )

cv_df_homicide <-
  modelr::crossv_mc(homicide_df, 100)

cv_df_homicide <- cv_df_homicide %>% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )

```

### Fit Models

#### Violence
```{r}
cv_df_violence <-
  cv_df_violence %>% 
  mutate(
    MLR_all_var = map(train, \(df) lm(violence_rate ~ ., data = df)),
    MLR_best_subset = map(train, \(df) lm(violence_rate ~ gdp + inflation_rate + 
                          unemployment_rate + hdi + economic_crime_rate + personnel_rate +
                           alcohol_consumption_rate, data = df)),
    lasso = map(train, \(df) fit_glmnet(df, outcome = "violence_rate", 
                                        alpha = 1,lambda = lambda))
  ) %>% 
  mutate(
    rmse_all_var = map2_dbl(
      MLR_all_var, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_best_subset = map2_dbl(
      MLR_best_subset, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_lasso = map2_dbl(
      lasso, test, \(mod, test) rmse_glmnet(mod, test, "violence_rate"))
  ) %>% 
  select(starts_with("rmse_"))

```

#### Homicide
```{r}
cv_df_homicide <-
  cv_df_homicide %>% 
  mutate(
    MLR_all_var = map(train, \(df) lm(homicide_rate ~ ., data = df)),
    MLR_best_subset = map(train, \(df) lm(homicide_rate ~ unemployment_rate + 
                                            personnel_rate + hdi + economic_crime_rate, 
                                          data = df)),
    lasso = map(train, \(df) fit_glmnet(df, outcome = "homicide_rate", 
                                        alpha = 1,lambda = lambda))
  ) %>% 
  mutate(
    rmse_all_var = map2_dbl(
      MLR_all_var, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_best_subset = map2_dbl(
      MLR_best_subset, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_lasso = map2_dbl(
      lasso, test, \(mod, test) rmse_glmnet(mod, test, "homicide_rate"))
  ) %>% 
  select(starts_with("rmse_"))
```


### Comparing the RMSE

#### Violence
```{r }
cv_df_violence %>%
  pivot_longer(
    everything(),
    names_to = "Model", 
    values_to = "RMSE",
    names_prefix = "rmse_"
  ) %>% 
  mutate(
    Model = fct_inorder(Model)
  ) %>% 
  ggplot(aes(x = Model, y = RMSE)) +
  geom_violin() +
  ggtitle("RMSE by Model for Predicting Violence Rate") +
  theme(plot.title = element_text(hjust = 0.5))
```

Examining the distribution of RMSEs for each of the 3 models for 
predicting violence rate, we see that they are relatively similar. It appears 
that the MLR including all predictor variables has greater spread in lower 
RMSE values compared to the other two models.

The similarity in performance among all 3 models likely relates to the few
number of predictor variables that exist in our studied dataset. In general,
each of the 3 models will not differ by many predictor variables, and therefore
perform similarly. Comparing the 3 models, the best subset regression model
may be considered optimal as it reduces model complexity, without the 
caveat of difficulty interpreting beta coefficients, which occurs 
with lasso models.


#### Homicide
```{r }
cv_df_homicide %>%
  pivot_longer(
    everything(),
    names_to = "Model", 
    values_to = "RMSE",
    names_prefix = "rmse_"
  )%>% 
  mutate(
    Model = fct_inorder(Model)
  ) %>% 
  ggplot(aes(x = Model, y = RMSE)) +
  geom_violin() +
  ggtitle("RMSE by Model for Predicting Homicide Rate") +
  theme(plot.title = element_text(hjust = 0.5))
```

Examining the 3 models we used to predict homicide rate, we see that 
the distribution of RMSE across 100-fold cross-validation are nearly identical. 
This is likely in regard to the few predictor variables included in our dataset.
In particular, with such few predictor variables, lasso is likely not the most 
well-suited for this task, since there is not a serious need to reduce model 
complexity. Consequently, the number of variables included in each of the 3 
models is  similar, and the difference of 1 or 2 included predictors 
between each of the models does not produce a substantial change in model 
effectiveness. Comparing the 3 models, the best subset regression model 
may be considered the best as it reduces model complexity but maintains 
ease of interpretationof beta coefficients, having a slightly  greater 
spread in lower RMSE values compared to the other two models, which is not 
as noticeable. 


## Model Diagnostics

### All Variables included MLR

```{r, message = FALSE, warning = FALSE}
baseline_hom_resid_df = 
  homicide_df |>
  add_residuals(baseline_MLR_hom) |>
  add_predictions(baseline_MLR_hom) 

baseline_viol_resid_df = 
  violence_df |>
  add_residuals(baseline_MLR_viol) |>
  add_predictions(baseline_MLR_viol) 

check_model(baseline_hom_resid_df, "MLR All Predictors Homicide Rate") 
check_model(baseline_viol_resid_df, "MLR All Predictors Violence Rate")
```
Examining the QQ-plots for the MLRs with all predictor variables included, we 
notice that our assumption of normality of residuals may be violated, as 
there are many lower-bound and upper-bound outliers that do not fall along 
the reference line. For the plots of fitted values versus residuals, we 
see differing results based on whether homicide rate or violence rate is 
the outcome variable. With homicide as the outcome variable, we can see 
residuals oscillate above and below the reference line, indicating approximate 
linearity of the relationship between the predictors and the outcome variables. 
However, the greater variability in the residuals as fitted values increase, 
suggests that we are seeing heteroscedasticity. Regarding violence rate as the 
outcome variable, we see both issues with heteroscedasticity and linearity. 

### Best Subset MLR

```{r, message = FALSE, warning = FALSE}
subset_homicide_resid_df = 
  homicide_df |>
  add_residuals(subset_homicide_lm) |>
  add_predictions(subset_homicide_lm) 

subset_violence_resid_df = 
  violence_df |>
  add_residuals(subset_violence_lm) |>
  add_predictions(subset_violence_lm) 

check_model(subset_homicide_resid_df, "MLR Best-Subset Homicide Rate")
check_model(subset_violence_resid_df, "MLR Best-Subset Violence Rate")
```

Examining the QQ-plots for the MLRs using the best-subset of predictor variables, 
we once again notice that our assumption of normality of residuals may be in 
violation, as there appear to many lower-bound and upper-bound outliers that do 
not fall along the reference line. For the fitted versus residuals plot for 
homicide rate, we see violations of both linearity and homosecdascity. The 
equivalent plot for violence rate presents similar concerns regarding 
homoscedascity, but shows a greater spread of residuals along the horizontal 
reference line, and therefore better implies linearity of relationship between
predictor variables and outcome. 


### Lasso

```{r, message = FALSE, warning - FALSE}
lasso_homicide_resid_df =
  lasso_homicide_resid |> 
  pull(residuals) |>
  bind_cols(lasso_predict_homicide) |>
  rename(resid = "...1", pred = "...2")

lasso_violence_resid_df =
  lasso_violence_resid |> 
  pull(residuals) |>
  bind_cols(lasso_predict_violence) |>
  rename(resid = "...1", pred = "...2")

check_model(lasso_homicide_resid_df, "Lasso Homicide Rate")
check_model(lasso_violence_resid_df, "Lasso Violence Rate")
```

Consistent with results from the QQ-plots of the previous two MLR models, lasso 
models for both homicide rate and violence rate show potential violations of the 
assumption of normality, as many lower-bound and upper-bound outlier residuals
do not fall along the reference line. For the fitted versus residuals plot 
of homicide and violence rates, we see a very low possibility of heteroscedascity 
and non-linearity, since the horizontal line crosses the value of zero, but this 
acceptable since this deviation is very insignificant.

## Conclusion

Based on our comparisons of RMSE, we can conclude that our best-subset regression 
models are most accurate at predicting the outcomes: (1) Violence Rate and (2) 
Homicide Rate. 

The best-subset regression model for predicting violence 
rate yielded an adjusted r-squared of 
`r round(violence_best_subset_rsq[["Criterion"]], 2)` and included 
the following variables as predictors: GDP, inflation rate, economic crime rate, hdi, unemployment rate, personnel rate, and alcohol consumption rate. The 
best-subset regression model for predicting homicide rate returned an 
r-squared of `r round(homicide_best_subset_rsq[["Criterion"]], 2)`. The 
variables included in this model were unemployment rate, HDI, economic crime 
rate and personnel rate. 

**Below are some important interpretations of our findings, based on the best-subset regression model for predicting homicide rate:**

HDI (Coefficient = -18.50047), p-value < 2e-16:
A 1-unit increase in the HDI results in a decrease of 18.50047 units in the transformed homicide rate, holding all other variables constant. Since the p-value is very small, HDI has a strong negative effect on the transformed homicide rate.

Economic Crime Rate (Coefficient = 0.12511, p-value = 9.21e-08):
A 1-unit increase in transformed economic crime rate results in an increase of 0.12511 units in transformed homicide rate, holding all other variables constant. The p-value is very small, indicating statistical significance.

Personnel Rate (Coefficient = 0.09847, p-value = 0.000268):
A 1-unit increase in transformed personnel rate results in an increase of 0.09847 units in the transformed homicide rate, holding other predictors constant. The small p-value (0.000268) also makes this effect statistically significant. This is rather surprising, because we believed an increase in personnel rate should decrease homicide rate. However, because personnel rate is a variable that also includes judges, this result might make sense. 

**Here are some of our important findings based on the best-subset regression model for predicting violence rate:**

Economic Crime Rate (coefficient: 0.43184, p-value: < 2e-16)
A 1-unit increase in the transformed economic crime rate results in an increase of 0.43184 units in the transformed violence rate, holding all other variables constant. The p-value is extremely small, indicating a  significant relationship. This is consistent with the model predicting homicide rate.

GDP (coefficient: 0.33523, p-value: 3.22e-07)
A 1-unit increase in transformed GDP results in an increase of 0.33523 units in the transformed violence rate, holding all other variables constant. The p-value is very small, suggesting statistical significance. The association between economic growth and violence is surprising because we might previously associate higher crime with countries with lower GDP. However, these results may suggest that GDP growth can exacerbate inequality and drive violence. 

Alcohol Consumption Rate (coefficient: -0.19195, p-value: 0.000146)
A 1-unit increase in transformed alcohol consumption rate results in a decrease of 0.19195 units in the transformed violence rate, holding all other variables constant. The p-value is small (0.000146), indicating statistical significance. This result was also unexpected because we previously believed higher alcohol consumption would lead to an [increase in violence](https://pmc.ncbi.nlm.nih.gov/articles/PMC8729263/), since it's associated with aggression, mood and personality disorders. This might be due to 
limitations in our data quality. 


# *Discussion*

The findings from our project highlight several important observations:

**Homicide Victim Rates:**
As expected, the Americas have by far the highest rates of homicide victims with most victims being male. Over the last couple of years, there has been significant news coverage on conflicts of gang violence in South America, and issues of increasing crime across the United States. Asia has the second highest male victim rate, but interestingly, a sharp decrease occurred in 2022. Oceania, Africa and Europe have similarly low homicide rates in comparison. Africa did have a noticeable increase in homicides during the pandemic, which similar to the Americas, faced several military coups like in Niger and Gabon. 

Looking closer at the high homicide rates of the Americas and Asia, the relationships between victim-perpetrators in the Americas were unknown. But in Asia, it was interestingly socio-political homicide.  Given the diversity of Asia’s ethnicities, races, religions, political/economic/social views though, this is not necessarily surprising. 

**Violent Offence Rates**
Oceania has the highest rate of violent offences for all years until 2022, where the Americas meets it. The most common offence category for Oceania (and in general) was serious assault. Acts intended to induce emotional fear or distress was the second highest. Given media coverage and our own preconceived notions, sexual violence rates being low was unexpected. Therefore, we wanted to look more in-depth into sexual violence trends since in comparison to the magnitude other violence categories, it may have been hidden. In that exploration, we see that there have been increasing rates of sexual violence against women across all regions except for Asia. This reflects what we know and is reiterated by UN reports on the changing nature of global violence.

**Statistical Analyses**
We employed several statistical methods to determine the optimal model for predicting homicide and violence rates. We found that using `regsubset` yielded the best models, where important predictors for violence rate are GDP, inflation rate, unemployment rate, economic crime rate, personnel rate, and alcohol consumption rate, and important predictors for homicide rate are unemployment rate, HDI, economic crime rate and personnel rate.

**Significance of Findings**
The results of our regression analysis are consistent with global trends in violence, emphasizing the impact of socioeconomic factors and crime. Our model suggests that economic instability, indicated by inflation and unemployment rates, and socioeconomic development, indicated by HDI, are significant factors for homicide and violence. This makes sense, as economic crises exacerbate social tensions, leading to increased crimes of violence. The UN highlights that regions with high economic volatility and low development are more prone to conflict and violence, since unemployment and inflation create opportunity for criminal activities and homicides.

Furthermore, our analysis shows economic crime rates as a predictor of homicide, reflecting the UN’s own observations that organized crime and corruption drive violence, particularly in areas with weak governance and political instability. The UN has emphasized that non-state actors, such as criminal organizations and militias, play a role in perpetuating violence in regions where state institutions are fragile. 

Finally, our findings on the role of human development indicators and substance abuse, such as alcohol consumption, are also reflected by broader global trends. The UN reported that women and children are disproportionately affected by domestic violence and gender-based homicides, which are often exacerbated by substance abuse. These insights align with our model’s predictors, emphasizing the intersection of social inequality, substance abuse, and violence. 

**Source: https://www.un.org/en/un75/new-era-conflict-and-violence**

**Challenges and Limitations**:
External validity is compromised in our analysis due to the presence of NA values in our dataset since we may not be able to generalize our findings in a global context. Furthermore, data quality issues also pose a challenge to our analysis.  Missing data here may be due to national governments or regional law enforcement restricting the release of detailed data on violence to protect sensitive information, maintain political stability or hold on their citizens.  Furthermore, data collection methodologies vary based on countries - some countries may not have the proper infrastructure for data collection. The nuances of cultural context will also play a role here, as what is considered violence to one country may not be considered in other countries.

Limitations to our methodology include not being able to account for temporality in our analysis, and not being able to capture the variation in violence and homicide rates based on countries and regions. Further work includes building models specific for countries and regions while accounting for temporality.  It would also be very interesting to create visualizations for more specific crime data, by country. We can also include unsupervised learning methods such as clustering to identify region-specific predictors that contribute to violence. 


# *Citation*

* National Library of Medicine (2021), Alcohol, Aggression, and Violence: From 
Public Health to Neuroscience. https://pmc.ncbi.nlm.nih.gov/articles/PMC8729263/ 
(Accessed on Dec. 2024)
* United Nations, A New Era of Conflict and Violence. 
https://www.un.org/en/un75/new-era-conflict-and-violence (Accessed on Dec. 2024).
* UNODC (2024), UNODC Research - Data Portal – Access and
functioning of justice. https://dataunodc.un.org/dp-cjs-persons-convicted (Accessed on Nov. 2024).
* UNODC (2024), UNODC Research - Data Portal – Corruption and
Economic Crime. https://dataunodc.un.org/dp-crime-corruption-offences (Accessed on Nov. 2024).
* UNODC (2024), UNODC Research - Data Portal - Violent and Sexual
Crime. https://dataunodc.un.org/dp-crime-violent-offences (Accessed on Nov. 2024)
