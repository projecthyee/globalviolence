---
title: "EDA"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)

merged_violence_df = read_csv("./data/merged_violence.csv")
homicide_visual_df = read_csv("./data/homicide_visual.csv")
violence_visual_df = read_csv("./data/violence_visual.csv")
```

# Homicide

## Global Trend
```{r message = FALSE}
homicide_visual_df |>
  group_by(region, sex, year) |>
  summarize(avg_homicide_rate = mean(homicide_rate)) |>
  ggplot(aes(y = avg_homicide_rate, x = year, color = sex)) +
  geom_smooth(se = FALSE) +
  facet_grid(~region) + 
  labs(x = "Year",
       y = "Average Homicide Rate",
       Title = "Average Homicide Rate Trend")
```

The Americas and Asia have significantly higher average homicide rate across 
years for male victims compared to the other regions. The average homicide rate 
between genders are not significant for Africa, Asia and Oceania. 

## Americas and Asia
```{r message = FALSE, warning = FALSE}
homicide_visual_df |>
  filter(region %in% c("Asia", "Americas")) |>
  group_by(category, region) |>
  summarize(avg_homicide_rate = mean(homicide_rate)) |>
  ggplot(aes(y = avg_homicide_rate, x = region,
             fill = reorder(category, avg_homicide_rate))) +
  geom_col(position = "dodge", bin = 3.0) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Region",
       y = "Average Homicide Rate",
       Title = "Average Homicide Rate Across Category", 
       fill = "Category")
```

Further exploring homicide in Americas and Asia, the Americas have higher 
homicide rates for most categories compared to Asia. Homicides of perpetrator 
to victim relationship unknown has the largest homicide rate. Homicides of 
unknown types is next category with the highest homicide rate in the Americas. 

On the other hand, Asia has a significantly high homicide rate in 
socio-political homicide compared to the other categories,suggesting high 
casualties as a result of socio-political activities for countries in Asia. 
The other categories have a homicide rate lesser than 5 percent. 

## Proportion of Categories
```{r message = FALSE}
homicide_visual_df |>
  group_by(category, year) |>
  summarize(avg_homicide_rate = mean(homicide_rate)) |>
  ggplot(aes(y = avg_homicide_rate, x = as.factor(year), fill = 
               reorder(category, avg_homicide_rate))) +
  geom_bar(stat = "identity") + 
  labs(x = "Year",
       y = "Total Homicide Rate",
       Title = "Homicide Rate by Category",
       fill = "Category")
```

Homicides of unknown types and perpetrator to victim relationship unknown are 
two highest proportions in the total homicide rate, indicating most homicides 
are committed by strangers or have no connection with the victims. Also, we can 
observe that homicide rates as a result of organized criminal groups or gangs 
and interpersonal homicide are the next significant proportions in homicide. 
The total homicide rate increases sharply from 2015 to 2017 compared to the 
other years possibly due to socioeconomic factors, such as economic instability. 


# Violence

## Global Trend
```{r message = FALSE}
violence_visual_df |>
  filter(indicator == "Violent offences") |>
  group_by(region, sex, year) |>
  summarize(avg_violence_rate = mean(violence_rate)) |>
  ggplot(aes(y = avg_violence_rate, x = year, color = region)) +
  geom_smooth(se = FALSE) +
  labs(x = "Year",
       y = "Average Rate of Violence Offences",
       Title = "Average Violence Rate Trend") 
```

Oceania has a significantly high average rate of violent offences compared to 
the other regions. Moreover, the average rate for Oceania increases at 2020, 
but declines significantly until 2022. The rate for Africa has shown a steady 
decrease from 2017 until 2022. Comparatively, the rate of violence offences for 
Americas, Europe and Asia has been stable over the years. 

## Categories of Violence Offences
```{r message = FALSE, fig.height = 10}
violence_visual_df |>
  filter(indicator == "Violent offences") |>
  group_by(category, year, region) |> 
  summarise(avg_violence_rate = mean(violence_rate)) |> 
  mutate(category = fct_reorder(category, avg_violence_rate)) |>
  ggplot(aes(x = category, y = avg_violence_rate, fill = region)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~year, ncol=2) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

For every year except 2022, Oceania is the region with the highest rates for the serious assault
and sexual violence category. Interestingly, the gap between Oceania and the Americas decreases greatly in 2022 with Oceania's drop in assault rates. 

## Victims of Sexual Violence
```{r message = FALSE}
violence_visual_df |>
  filter(indicator == "Victims of sexual violence",
         region != "Africa") |>
  group_by(region, sex, year) |>
  summarize(avg_victim_rate = mean(violence_rate)) |>
  ggplot(aes(y = avg_victim_rate, x = year, color = sex)) +
  geom_smooth(se = FALSE) +
  facet_grid(~region) +
  labs(x = "Year",
       y = "Victim Rate of Sexual Violence",
       Title = "Average Violence Rate Trend")
```

When exploring victim rate of sexual violence, we can see that in overall, 
there is a higher average victim rate for females; the largest disparity in 
victim rate between the genders can be observed in Oceania, where the rate for 
females have been sharply increasing over the years. The victim rate for the 
Americas and Europe has also been increasing, but steadily compared to Oceania 
over the years, while Asia has experienced a decline from 2019. Africa was not 
included because the data was either very small or missing for many countries 
in the region. 

## Categories of Sexual Violence
```{r message = FALSE}
violence_visual_df |>
  filter(indicator == "Victims of sexual violence",
         region != "Africa") |>
  group_by(category, sex, region) |>
  summarize(avg_victim_rate = mean(violence_rate)) |>
  ggplot(aes(y = avg_victim_rate, x = region, 
             fill = reorder(category, avg_victim_rate))) +
  geom_col(position = "dodge") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Region",
       y = "Average Victim Rate",
       Title = "Average Victim Rate Across Category", 
       fill = "Category")
```

Further exploring victims of sexual violence, except for perpetrator unknown to 
the victim, Oceania has a higher average victim rate of sexual violence for the 
all other categories compared to the other regions. Oceania, Europe and Americas 
have relationship of perpetrator is not known as the highest category for 
victim rate. Similar to homicide, the perpetrators are strangers or have no 
connection with the victims for most sexual violence. On the other hand, Asia 
has a significantly low average victim rate, having other perpetrator known to 
the victim as the category with the highest rate.

## Proportion of Categories
```{r message = FALSE}
violence_visual_df |>
  filter(indicator == "Victims of sexual violence",
         region != "Africa") |>
  group_by(category, year) |>
  summarize(avg_victim_rate = mean(violence_rate)) |>
  ggplot(aes(y = avg_victim_rate, x = as.factor(year), 
             fill = reorder(category, avg_victim_rate))) +
  geom_bar(stat = "identity") + 
  labs(x = "Year",
       y = "Total Victim Rate",
       Title = "Victim Rate by Category",
       fill = "Category")
```

Relationship to perpetrator is not known is the category with a significant 
proportion to total victim rate of sexual violence compared to the other 
categories across the years. The proportion of victim rates for the other three 
categories become approximately equal to each other from 2019. Specifically, 
the proportion for intimate partner or family member and perpetrator unknown to 
the victim increases over time.

# Global Prevalence of Violence 

Across the time period from 2015 to 2023, the Americas consistently exhibited 
a significantly higher homicide rate compared to other regions. The difference 
in this region is pronounced, indicating a persistent and widespread issue with 
violent crime. The homicide rate in Asia is also notable. There was a rising 
trend in homicide rate from 2015 to 2021, but was followed by a sharp decrease 
in 2022. However, it should be noted that not all countries that reported 
homicide rate also reported the violence rate. 

The drop in 2022 may imply that there was a potential shift or improvement in 
the region, but it could also mean that there are some missing data in that 
year, leading a bias or misinterpretation. 

When examining violence rates, the Americas followed a similar trend to the 
homicide rate, with rates significantly higher than the other regions. This 
trend reflects the persistent issue of violence in the region, affecting not 
only homicide rates but also broader forms of violence. However, Oceania 
presented an extreme outlier in terms of victim rates of sexual violence, 
surpassing even the Americas.