<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Regression</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="data_cleaning.html">Data Cleaning</a>
</li>
<li>
  <a href="eda.html">EDA</a>
</li>
<li>
  <a href="regression.html">Regression</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Shiny &amp; Dashboard
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://yousmni3269.shinyapps.io/shiny_prevalence/">Prevalence of Violence</a>
    </li>
    <li>
      <a href="https://yousmni3269.shinyapps.io/shiny_trend/">Trends of Violence</a>
    </li>
    <li>
      <a href="plotly_vs.html">Homicide vs. Violence</a>
    </li>
  </ul>
</li>
<li>
  <a href="p8105_fp_report.html">Project Report</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="aboutus.html">About Us</a>
</li>
<li>
  <a href="https://github.com/projecthyee/globalviolence">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><strong>Regression</strong></h1>

</div>


<div id="background" class="section level1">
<h1><em>Background</em></h1>
<p>Our motivation for doing regression is to determine the significant
predictors of the two measures of violence: (1) homicide victim rate and
(2) violent offences rate.</p>
<p>Global violence is a complex issue, depending on many factors, from
political, cultural, to economic. We aimed to choose predictors that
reflect inequality which are often related to social unrest and
violence. Much numerical data exists for the economic indicators of a
country such as GDP, inflation and unemployment rate, and we also wanted
to include HDI since that in itself is a well-recognized global
measurement. Intuitively, criminal activity is also related to violence,
so indicators for economic crime rate and criminal justice personnel
were considered. Lastly, alcohol rate was included because substance
usage is often perceived to be correlated with violence. Subsequently,
we aim to develop models that show which factors are the best predictors
of homicide and violence rates.</p>
<p>Given the plausible theoretical linkage between each of our included
predictor variables and the outcome variables of interest, we seek to
develop models that can determine which factors are most predictive of
homicide and violence rate.</p>
<p>We performed this analysis to uncover the extent to which different
factors influence homicide rate and violence rate as outcomes.</p>
</div>
<div id="functions-for-fitting-data" class="section level1">
<h1><em>Functions for Fitting Data</em></h1>
<div id="best_subset" class="section level2">
<h2>best_subset</h2>
<pre class="r"><code>best_subset = function(predictor, outcome, criterion) {
  
  optimal_subset &lt;- 
    leaps(x = predictor, y = outcome, nbest = 3, 
      method = criterion, names = names(predictor))
  
  if (criterion == &quot;Cp&quot;) {
    optimal_criterion &lt;- optimal_subset[[criterion]] %&gt;% min()
    optimal_subset_idx &lt;- optimal_subset[[criterion]] %&gt;% which.min()
    
  } else {
    optimal_criterion &lt;- optimal_subset[[criterion]] %&gt;% max()
    optimal_subset_idx &lt;- optimal_subset[[criterion]] %&gt;% which.max()
  }
  
  return(list(Criterion = optimal_criterion , 
       Variable_Selection = optimal_subset$which[optimal_subset_idx,]))
  
}</code></pre>
<p>This function serves as a wrapper around the leaps function. It
performs best-subset variable selection and then prints out the optimal
model diagnostic and the predictor variables included in the regression
model.</p>
</div>
<div id="fit_glmnet" class="section level2">
<h2>fit_glmnet</h2>
<pre class="r"><code>fit_glmnet = function(df, alpha, outcome, lambda) {
  
  outcome_formula &lt;- as.formula(paste(outcome, &quot;~.&quot;))
  predictor &lt;- model.matrix(outcome_formula, data = df)[,-1]
  predicted &lt;- df %&gt;% pull(outcome)
  
  model_fit &lt;- 
    glmnet(predictor, predicted, lambda = lambda, alpha = alpha)
  
  model_cv &lt;-
    cv.glmnet(predictor, predicted, lambda = lambda, alpha = alpha)
  
  lambda_opt = model_cv[[&quot;lambda.min&quot;]]
  
  model_fit &lt;-
    glmnet(predictor, predicted, lambda = lambda_opt, alpha = alpha)
  
  return(model_fit)
  
}</code></pre>
<p>This function serves as a wrapper for the glmnet fitting processing
and covers both the fitting and cross-validation process. It returns the
glmnet object produced after fitting with optimal lambda value.</p>
</div>
<div id="rmse_glmnet" class="section level2">
<h2>rmse_glmnet</h2>
<pre class="r"><code>rmse_glmnet = function(model, test, outcome) {
  outcome_formula &lt;- as.formula(paste(outcome, &quot;~.&quot;))
  predictor &lt;- model.matrix(outcome_formula, data = test)[,-1]
  predictions &lt;- predict.glmnet(model, model[[&quot;lambda&quot;]], newx = predictor,
                               type = &quot;response&quot;)
  
  predictions &lt;- as.vector(predictions)
  observed &lt;- test %&gt;% 
    pull(outcome)
  
  return(caret::RMSE(predictions, observed))
  
}</code></pre>
<p>This is a wrapper function for the glmnet prediction and evaluation
process. Given a fitted glmnet model, a test dataset, and an outcome
variable of interest, this function predicts the avlues in the test
dataset and then calculates and returns the rmse.</p>
</div>
<div id="check_model" class="section level2">
<h2>check_model</h2>
<pre class="r"><code>check_model = function(data, name) {
  
  resid_fit = 
    data |&gt;
    ggplot(aes(y = resid, x = pred)) +
    geom_point() +
    geom_smooth(method = &quot;lm&quot;) + 
    labs(title = paste(&quot;Residual vs. Fitted:&quot;, name),
         y = &quot;Residual&quot;, 
         x = &quot;Fitted Value&quot;)
  
  print(resid_fit)
  qqnorm(pull(data, resid), main = paste(&quot;QQ Plot: &quot;, name))
  qqline(pull(data, resid), col = &quot;red&quot;)
  
}</code></pre>
<p>This is a plotting function to combine several different plot types
that assess the assumptions of linear models.</p>
</div>
</div>
<div id="descriptive-statistics" class="section level1">
<h1><em>Descriptive Statistics</em></h1>
<div id="visualizations-of-distributions" class="section level2">
<h2>Visualizations of Distributions</h2>
<p><img src="regression_files/figure-html/distributions-1.png" width="1920" /></p>
<p>All variables are skewed right, except for HDI which is bimodal and
slightly left-skewed. Hence, we decided to apply ln transformations and
Box-Cox transformations to ensure normality of the data.</p>
</div>
<div id="data-transformations" class="section level2">
<h2>Data Transformations</h2>
<div id="natural-log-transform" class="section level3">
<h3>Natural Log Transform</h3>
<pre class="r"><code>ln_transform = function(value) {
  return(log(abs(value)))
}

ln_df = 
  merged_violence_df |&gt;
  mutate(across(c(homicide_rate:alcohol_consumption_rate), 
                ln_transform))

ln_df |&gt;
  select(homicide_rate:alcohol_consumption_rate) |&gt;
  ggpairs()</code></pre>
<p><img src="regression_files/figure-html/ln-transform-1.png" width="1920" /></p>
</div>
<div id="box-cox-transform" class="section level3">
<h3>Box-Cox Transform</h3>
<pre class="r"><code>boxcox_transform = function(value) {
  if (all(is.na(value))) {
    return(value) 
  }

  min_value = min(value, na.rm = TRUE) 
  if (min_value &lt;= 0) {
    value = value + abs(min_value) + 0.00001  
  }

  if (length(unique(value)) == 1) {
    return(value) 
  }

  boxcox_result = MASS::boxcox(value ~ 1, plotit = FALSE)
  lambda = boxcox_result$x[which.max(boxcox_result$y)]  

  if(lambda != 0) {
    transformed_value = (value^lambda - 1) / lambda
  } else {
    transformed_value = log(value)
  }
  return(transformed_value)
}

boxcox_df = merged_violence_df |&gt; 
  mutate(across(c(homicide_rate:alcohol_consumption_rate), 
                ~ boxcox_transform(.)))

boxcox_df |&gt;
  select(homicide_rate:alcohol_consumption_rate) |&gt;
  ggpairs()</code></pre>
<p><img src="regression_files/figure-html/boxcox-1.png" width="1920" /></p>
<p>Both natural log and boxcox transformations substantially normalized
the distributions. Since boxcox resulted in more improved results as
shown in the plots above, we decided to use the boxcox transformed data
for regression.</p>
</div>
</div>
<div id="multicolliniearity-diagnostics" class="section level2">
<h2>Multicolliniearity Diagnostics</h2>
<p>We used <code>cor()</code> to find the correlation between the eight
predictors of homicide rate and violence.</p>
<pre class="r"><code>cor_matrix = 
  cor(boxcox_df[, c(&quot;gdp&quot;, &quot;inflation_rate&quot;, &quot;unemployment_rate&quot;, &quot;hdi&quot;,
                             &quot;economic_crime_rate&quot;, &quot;personnel_rate&quot;, &quot;trafficked_victims&quot;, 
                             &quot;alcohol_consumption_rate&quot;)], use = &quot;pairwise.complete.obs&quot;)

ggcorrplot(cor_matrix, 
           method = &quot;circle&quot;,  
           type = &quot;lower&quot;,  
           lab = TRUE,        
           lab_size = 3,      
           colors = c(&quot;blue&quot;, &quot;white&quot;, &quot;red&quot;), # Color scale (blue = negative, red = positive)
           title = &quot;Correlation Heatmap&quot;
)</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>There is moderate correlation between <code>hdi</code> and
<code>alcohol_consumption_rate</code> (corr = 0.56), <code>hdi</code>
and <code>economic_crime_rate</code> (corr = 0.57), and <code>gdp</code>
and <code>trafficked_victims</code> (corr - 0.51).</p>
</div>
</div>
<div id="data-pre-processing" class="section level1">
<h1><em>Data Pre-Processing</em></h1>
<div id="define-lambda-range" class="section level2">
<h2>Define Lambda Range</h2>
<pre class="r"><code>lambda = 10^(seq(-2, 2.75, 0.1))</code></pre>
</div>
<div id="approach-to-pre-processing-data" class="section level2">
<h2>Approach to Pre-Processing Data</h2>
<p>Prior to performing any model fitting, we split our initial dataset
into separate homicide and violence datasets, each of which includes the
outcome variable and all numeric predictor variables. Specific predictor
and outcome dataframes, and an outcome matrix, are created for later use
in linear models, as well as lasso.</p>
<div id="pre-processing-for-homicide" class="section level3">
<h3>Pre-Processing for Homicide</h3>
<pre class="r"><code>homicide_df =
  boxcox_df |&gt; 
  ungroup() |&gt; 
  select(-violence_rate, -year, -country, -region, -iso3_code) |&gt; 
  drop_na()

homicide_matrix &lt;- model.matrix(homicide_rate ~., data = homicide_df)[,-1]

homicide_predictors &lt;- homicide_df %&gt;% 
  select(-homicide_rate)

homicide_outcome &lt;- homicide_df %&gt;% 
  pull(homicide_rate)</code></pre>
</div>
<div id="pre-processing-for-violence" class="section level3">
<h3>Pre-Processing for Violence</h3>
<pre class="r"><code>violence_df =
  boxcox_df |&gt; 
  ungroup() |&gt; 
  select(-year, -homicide_rate, -country, -region, -iso3_code) |&gt;
  drop_na()

violence_matrix &lt;- model.matrix(violence_rate ~., data = violence_df)[,-1]
  
violence_predictors &lt;- violence_df %&gt;% 
  select(-violence_rate)

violence_outcome &lt;- violence_df %&gt;% 
  pull(violence_rate)</code></pre>
</div>
</div>
</div>
<div id="baseline-mlr-with-additive-effects" class="section level1">
<h1><em>Baseline MLR with Additive Effects</em></h1>
<p>First, we decided to fit a baseline MLR with additive effects from
all possible predictor variables to use as a point of reference for our
modeling process. This step provides insight into which<br />
covariates contribute to the outcomes of interest.</p>
<div id="predict-homicide-rates" class="section level2">
<h2>Predict Homicide Rates</h2>
<pre class="r"><code>baseline_MLR_hom &lt;- lm(homicide_rate ~ gdp + inflation_rate + unemployment_rate +
                   hdi + economic_crime_rate + personnel_rate + trafficked_victims + 
                    alcohol_consumption_rate , data = homicide_df)

baseline_MLR_hom_fitted &lt;- baseline_MLR_hom[[&quot;fitted.values&quot;]]

baseline_MLR_hom %&gt;% 
  broom::tidy() %&gt;% 
  knitr::kable()</code></pre>
<table style="width:100%;">
<colgroup>
<col width="36%" />
<col width="17%" />
<col width="14%" />
<col width="17%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-3.9032006</td>
<td align="right">1.4399630</td>
<td align="right">-2.7106255</td>
<td align="right">0.0071011</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">0.0299927</td>
<td align="right">0.0541667</td>
<td align="right">0.5537121</td>
<td align="right">0.5801870</td>
</tr>
<tr class="odd">
<td align="left">inflation_rate</td>
<td align="right">0.0795285</td>
<td align="right">0.0844521</td>
<td align="right">0.9416997</td>
<td align="right">0.3471015</td>
</tr>
<tr class="even">
<td align="left">unemployment_rate</td>
<td align="right">-0.0988592</td>
<td align="right">0.0930715</td>
<td align="right">-1.0621849</td>
<td align="right">0.2890032</td>
</tr>
<tr class="odd">
<td align="left">hdi</td>
<td align="right">-18.4277564</td>
<td align="right">1.4752699</td>
<td align="right">-12.4911086</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">economic_crime_rate</td>
<td align="right">0.1235555</td>
<td align="right">0.0231158</td>
<td align="right">5.3450640</td>
<td align="right">0.0000002</td>
</tr>
<tr class="odd">
<td align="left">personnel_rate</td>
<td align="right">0.1026731</td>
<td align="right">0.0272480</td>
<td align="right">3.7681001</td>
<td align="right">0.0001979</td>
</tr>
<tr class="even">
<td align="left">trafficked_victims</td>
<td align="right">-0.0156416</td>
<td align="right">0.0821390</td>
<td align="right">-0.1904282</td>
<td align="right">0.8491019</td>
</tr>
<tr class="odd">
<td align="left">alcohol_consumption_rate</td>
<td align="right">-0.0105024</td>
<td align="right">0.0307245</td>
<td align="right">-0.3418237</td>
<td align="right">0.7327221</td>
</tr>
</tbody>
</table>
<p>Results from baseline MLR show that that HDI, economic crime rate and
personnel rate are significant predictors of homicide.</p>
</div>
<div id="collinearity-of-baseline-homicide-model"
class="section level2">
<h2>Collinearity of Baseline Homicide Model</h2>
<pre class="r"><code>vif_baseline_hom_MLR &lt;- car::vif(baseline_MLR_hom)
vif_baseline_hom_MLR %&gt;% 
  tibble(
    variable = names(vif_baseline_hom_MLR),
    VIF = vif_baseline_hom_MLR
  ) %&gt;% 
  select(variable, VIF) %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gdp</td>
<td align="right">3.092922</td>
</tr>
<tr class="even">
<td align="left">inflation_rate</td>
<td align="right">1.163745</td>
</tr>
<tr class="odd">
<td align="left">unemployment_rate</td>
<td align="right">1.176497</td>
</tr>
<tr class="even">
<td align="left">hdi</td>
<td align="right">4.019360</td>
</tr>
<tr class="odd">
<td align="left">economic_crime_rate</td>
<td align="right">2.158875</td>
</tr>
<tr class="even">
<td align="left">personnel_rate</td>
<td align="right">1.249265</td>
</tr>
<tr class="odd">
<td align="left">trafficked_victims</td>
<td align="right">2.189643</td>
</tr>
<tr class="even">
<td align="left">alcohol_consumption_rate</td>
<td align="right">2.086040</td>
</tr>
</tbody>
</table>
<p>Results from VIF show that there is no serious multicollinearity
issue (VIF &lt; 5).</p>
</div>
<div id="predict-violence-rates" class="section level2">
<h2>Predict Violence Rates</h2>
<pre class="r"><code>baseline_MLR_viol &lt;- lm(violence_rate ~ gdp + inflation_rate + unemployment_rate +
                   hdi + economic_crime_rate + personnel_rate + trafficked_victims + 
                    alcohol_consumption_rate , data = violence_df)

baseline_MLR_viol_fitted &lt;- baseline_MLR_viol[[&quot;fitted.values&quot;]]

baseline_MLR_viol %&gt;% 
  broom::tidy() %&gt;% 
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="37%" />
<col width="16%" />
<col width="14%" />
<col width="16%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-7.2867592</td>
<td align="right">2.4450455</td>
<td align="right">-2.9802141</td>
<td align="right">0.0031153</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">0.3805697</td>
<td align="right">0.0919746</td>
<td align="right">4.1377720</td>
<td align="right">0.0000456</td>
</tr>
<tr class="odd">
<td align="left">inflation_rate</td>
<td align="right">-0.3288844</td>
<td align="right">0.1433989</td>
<td align="right">-2.2934927</td>
<td align="right">0.0225086</td>
</tr>
<tr class="even">
<td align="left">unemployment_rate</td>
<td align="right">-0.3365298</td>
<td align="right">0.1580347</td>
<td align="right">-2.1294676</td>
<td align="right">0.0340269</td>
</tr>
<tr class="odd">
<td align="left">hdi</td>
<td align="right">-5.2981027</td>
<td align="right">2.5049963</td>
<td align="right">-2.1150142</td>
<td align="right">0.0352503</td>
</tr>
<tr class="even">
<td align="left">economic_crime_rate</td>
<td align="right">0.4300738</td>
<td align="right">0.0392505</td>
<td align="right">10.9571663</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">personnel_rate</td>
<td align="right">0.0553427</td>
<td align="right">0.0462668</td>
<td align="right">1.1961629</td>
<td align="right">0.2325744</td>
</tr>
<tr class="even">
<td align="left">trafficked_victims</td>
<td align="right">-0.0960016</td>
<td align="right">0.1394713</td>
<td align="right">-0.6883249</td>
<td align="right">0.4917783</td>
</tr>
<tr class="odd">
<td align="left">alcohol_consumption_rate</td>
<td align="right">-0.1815850</td>
<td align="right">0.0521699</td>
<td align="right">-3.4806480</td>
<td align="right">0.0005742</td>
</tr>
</tbody>
</table>
<p>Results from MLR show that <code>gdp</code>,
<code>inflation_rate</code>, <code>unemployment_rate</code>,
<code>hdi</code>, <code>economic_crime_rate</code>, and
<code>alcohol_consumption_rate</code> are significant predictors of
violence rate <span class="math inline">\(\alpha\)</span> = 0.01.</p>
</div>
<div id="collinearity-of-baseline-violence-model"
class="section level2">
<h2>Collinearity of Baseline Violence Model</h2>
<pre class="r"><code>vif_baseline_viol_MLR &lt;- car::vif(baseline_MLR_viol)
vif_baseline_viol_MLR %&gt;% 
  tibble(
    variable = names(vif_baseline_viol_MLR),
    VIF = vif_baseline_viol_MLR
  ) %&gt;% 
  select(variable, VIF) %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gdp</td>
<td align="right">3.092922</td>
</tr>
<tr class="even">
<td align="left">inflation_rate</td>
<td align="right">1.163745</td>
</tr>
<tr class="odd">
<td align="left">unemployment_rate</td>
<td align="right">1.176497</td>
</tr>
<tr class="even">
<td align="left">hdi</td>
<td align="right">4.019360</td>
</tr>
<tr class="odd">
<td align="left">economic_crime_rate</td>
<td align="right">2.158875</td>
</tr>
<tr class="even">
<td align="left">personnel_rate</td>
<td align="right">1.249265</td>
</tr>
<tr class="odd">
<td align="left">trafficked_victims</td>
<td align="right">2.189643</td>
</tr>
<tr class="even">
<td align="left">alcohol_consumption_rate</td>
<td align="right">2.086040</td>
</tr>
</tbody>
</table>
<p>Results from VIF show that there is no serious multicollinearity
issue (VIF &lt; 5).</p>
</div>
</div>
<div id="lasso" class="section level1">
<h1><em>Lasso</em></h1>
<p>We used lasso to as a feature selection tool to find the most
important variables in predicting homicide rate and violence rate.</p>
<div id="predictors-for-violence-rate" class="section level2">
<h2>Predictors for Violence Rate</h2>
<pre class="r"><code>lasso_violence_fit = 
  glmnet(violence_matrix, violence_outcome, lambda = lambda)

lasso_violence_cv = 
  cv.glmnet(violence_matrix, violence_outcome, lambda = lambda)

lambda_violence_opt = 
  lasso_violence_cv[[&quot;lambda.min&quot;]]

lasso_violence_fit = 
  glmnet(violence_matrix, violence_outcome, lambda = lambda_violence_opt)

lasso_violence_fit |&gt; 
  broom::tidy() |&gt; 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">step</th>
<th align="right">estimate</th>
<th align="right">lambda</th>
<th align="right">dev.ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">1</td>
<td align="right">-5.0456542</td>
<td align="right">0.0398107</td>
<td align="right">0.4726878</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">1</td>
<td align="right">0.2945710</td>
<td align="right">0.0398107</td>
<td align="right">0.4726878</td>
</tr>
<tr class="odd">
<td align="left">inflation_rate</td>
<td align="right">1</td>
<td align="right">-0.2342246</td>
<td align="right">0.0398107</td>
<td align="right">0.4726878</td>
</tr>
<tr class="even">
<td align="left">unemployment_rate</td>
<td align="right">1</td>
<td align="right">-0.2542552</td>
<td align="right">0.0398107</td>
<td align="right">0.4726878</td>
</tr>
<tr class="odd">
<td align="left">hdi</td>
<td align="right">1</td>
<td align="right">-2.3970548</td>
<td align="right">0.0398107</td>
<td align="right">0.4726878</td>
</tr>
<tr class="even">
<td align="left">economic_crime_rate</td>
<td align="right">1</td>
<td align="right">0.3989004</td>
<td align="right">0.0398107</td>
<td align="right">0.4726878</td>
</tr>
<tr class="odd">
<td align="left">personnel_rate</td>
<td align="right">1</td>
<td align="right">0.0392525</td>
<td align="right">0.0398107</td>
<td align="right">0.4726878</td>
</tr>
<tr class="even">
<td align="left">alcohol_consumption_rate</td>
<td align="right">1</td>
<td align="right">-0.1775654</td>
<td align="right">0.0398107</td>
<td align="right">0.4726878</td>
</tr>
</tbody>
</table>
<pre class="r"><code>lasso_predict_violence &lt;- 
  predict.glmnet(lasso_violence_fit, lambda_violence_opt, 
                 newx = violence_matrix, type = &quot;response&quot;)
  
lasso_predict_violence &lt;- as.vector(lasso_predict_violence)

lasso_violence_resid &lt;- tibble(
  residuals = violence_outcome - lasso_predict_violence
)</code></pre>
<p>The optimal lambda for violence rate is 0.04.</p>
</div>
<div id="predictors-for-homicide-rate" class="section level2">
<h2>Predictors for Homicide Rate</h2>
<pre class="r"><code>lasso_homicide_fit = 
  glmnet(homicide_matrix, homicide_outcome, lambda = lambda)

lasso_homicide_cv = 
  cv.glmnet(homicide_matrix, homicide_outcome, lambda = lambda)

lambda_homicide_opt = 
  lasso_homicide_cv[[&quot;lambda.min&quot;]]

lasso_homicide_fit = 
  glmnet(homicide_matrix, homicide_outcome, lambda = lambda_homicide_opt)

lasso_homicide_fit |&gt; 
  broom::tidy() |&gt; 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">step</th>
<th align="right">estimate</th>
<th align="right">lambda</th>
<th align="right">dev.ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">1</td>
<td align="right">-3.3086665</td>
<td align="right">0.0125893</td>
<td align="right">0.5730228</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">1</td>
<td align="right">0.0116957</td>
<td align="right">0.0125893</td>
<td align="right">0.5730228</td>
</tr>
<tr class="odd">
<td align="left">inflation_rate</td>
<td align="right">1</td>
<td align="right">0.0677735</td>
<td align="right">0.0125893</td>
<td align="right">0.5730228</td>
</tr>
<tr class="even">
<td align="left">unemployment_rate</td>
<td align="right">1</td>
<td align="right">-0.0806099</td>
<td align="right">0.0125893</td>
<td align="right">0.5730228</td>
</tr>
<tr class="odd">
<td align="left">hdi</td>
<td align="right">1</td>
<td align="right">-17.7625394</td>
<td align="right">0.0125893</td>
<td align="right">0.5730228</td>
</tr>
<tr class="even">
<td align="left">economic_crime_rate</td>
<td align="right">1</td>
<td align="right">0.1134648</td>
<td align="right">0.0125893</td>
<td align="right">0.5730228</td>
</tr>
<tr class="odd">
<td align="left">personnel_rate</td>
<td align="right">1</td>
<td align="right">0.0960788</td>
<td align="right">0.0125893</td>
<td align="right">0.5730228</td>
</tr>
<tr class="even">
<td align="left">alcohol_consumption_rate</td>
<td align="right">1</td>
<td align="right">-0.0068625</td>
<td align="right">0.0125893</td>
<td align="right">0.5730228</td>
</tr>
</tbody>
</table>
<pre class="r"><code>lasso_predict_homicide &lt;- 
  predict.glmnet(lasso_homicide_fit, lambda_homicide_opt, 
                 newx = homicide_matrix, type = &quot;response&quot;)
  
lasso_predict_homicide &lt;- as.vector(lasso_predict_homicide)

lasso_homicide_resid &lt;- tibble(
  residuals = homicide_outcome - lasso_predict_homicide
)</code></pre>
<p>The optimal lambda for homicide rate is 0.01.</p>
</div>
</div>
<div id="criterion-based-procedure" class="section level1">
<h1><em>Criterion-Based Procedure</em></h1>
<div id="best-subset-regression-for-violence" class="section level2">
<h2>Best-Subset Regression for Violence</h2>
<div id="predict-violence-rate-with-r-squared" class="section level3">
<h3>Predict Violence Rate with R-Squared</h3>
<pre class="r"><code>violence_best_subset_rsq &lt;- 
  best_subset(predictor = violence_predictors, outcome = violence_outcome, 
              criterion = &quot;adjr2&quot;)

violence_best_subset_rsq</code></pre>
<pre><code>## $Criterion
## [1] 0.4649232
## 
## $Variable_Selection
##                      gdp           inflation_rate        unemployment_rate 
##                     TRUE                     TRUE                     TRUE 
##                      hdi      economic_crime_rate           personnel_rate 
##                     TRUE                     TRUE                     TRUE 
##       trafficked_victims alcohol_consumption_rate 
##                    FALSE                     TRUE</code></pre>
</div>
<div id="predict-violence-rate-with-cp" class="section level3">
<h3>Predict Violence Rate with Cp</h3>
<pre class="r"><code>violence_best_subset_Cp &lt;- 
  best_subset(predictor = violence_predictors, outcome = violence_outcome, 
              criterion = &quot;Cp&quot;)
violence_best_subset_Cp</code></pre>
<pre><code>## $Criterion
## [1] 6.942997
## 
## $Variable_Selection
##                      gdp           inflation_rate        unemployment_rate 
##                     TRUE                     TRUE                     TRUE 
##                      hdi      economic_crime_rate           personnel_rate 
##                     TRUE                     TRUE                    FALSE 
##       trafficked_victims alcohol_consumption_rate 
##                    FALSE                     TRUE</code></pre>
</div>
<div id="collinearity-of-best-subset-violence-model"
class="section level3">
<h3>Collinearity of Best-Subset Violence Model</h3>
<pre class="r"><code>subset_violence_lm &lt;- lm(violence_rate ~ gdp + inflation_rate + unemployment_rate + hdi + economic_crime_rate + personnel_rate + alcohol_consumption_rate, data = violence_df)
summary(subset_violence_lm)</code></pre>
<pre><code>## 
## Call:
## lm(formula = violence_rate ~ gdp + inflation_rate + unemployment_rate + 
##     hdi + economic_crime_rate + personnel_rate + alcohol_consumption_rate, 
##     data = violence_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.8827 -0.9624 -0.1570  0.8284  6.2878 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)              -6.31311    1.99260  -3.168 0.001690 ** 
## gdp                       0.33523    0.06413   5.227 3.22e-07 ***
## inflation_rate           -0.33153    0.14322  -2.315 0.021293 *  
## unemployment_rate        -0.33631    0.15790  -2.130 0.033985 *  
## hdi                      -4.54750    2.25322  -2.018 0.044452 *  
## economic_crime_rate       0.43184    0.03913  11.035  &lt; 2e-16 ***
## personnel_rate            0.05607    0.04621   1.213 0.226015    
## alcohol_consumption_rate -0.19195    0.04991  -3.846 0.000146 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.627 on 302 degrees of freedom
## Multiple R-squared:  0.477,  Adjusted R-squared:  0.4649 
## F-statistic: 39.36 on 7 and 302 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>subset_violence_fitted &lt;- subset_violence_lm[[&quot;fitted.values&quot;]]


vif_subset_violence_model &lt;- car::vif(subset_violence_lm) 

vif_subset_violence_model %&gt;% 
  tibble(
    variable = names(vif_subset_violence_model),
    VIF = vif_subset_violence_model
  ) %&gt;% 
  select(variable, VIF) %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gdp</td>
<td align="right">1.506510</td>
</tr>
<tr class="even">
<td align="left">inflation_rate</td>
<td align="right">1.162907</td>
</tr>
<tr class="odd">
<td align="left">unemployment_rate</td>
<td align="right">1.176492</td>
</tr>
<tr class="even">
<td align="left">hdi</td>
<td align="right">3.257676</td>
</tr>
<tr class="odd">
<td align="left">economic_crime_rate</td>
<td align="right">2.149680</td>
</tr>
<tr class="even">
<td align="left">personnel_rate</td>
<td align="right">1.248621</td>
</tr>
<tr class="odd">
<td align="left">alcohol_consumption_rate</td>
<td align="right">1.912238</td>
</tr>
</tbody>
</table>
<p>All variables have VIF value below 5, suggesting that there is no
multi-colinearity concerns.</p>
</div>
<div id="interpretation" class="section level3">
<h3>Interpretation</h3>
<p>The results from both criterion-based procedures suggest that
significant predictors for <code>violence_rate</code> are
<code>gdp</code>, <code>inflation_rate</code>,
<code>unemployment_rate</code>, <code>economic_crime_rate</code>,
<code>personnel_rate</code>, <code>hdi</code> and
<code>alcohol_consumption rate</code>, with a total of 7 predictors.
This yields the most appropriate Cp value (6.94), which is approximately
close to the number of predictors, and highest adjusted R-squared
(0.46).</p>
</div>
</div>
<div id="best-subset-regression-for-homicide" class="section level2">
<h2>Best Subset Regression for Homicide</h2>
<div id="predict-homicide-rate-with-r-squared" class="section level3">
<h3>Predict Homicide Rate with R-Squared</h3>
<pre class="r"><code>homicide_best_subset_rsq &lt;- 
  best_subset(predictor = homicide_predictors, outcome = homicide_outcome, 
              criterion = &quot;adjr2&quot;)

homicide_best_subset_rsq</code></pre>
<pre><code>## $Criterion
## [1] 0.5660305
## 
## $Variable_Selection
##                      gdp           inflation_rate        unemployment_rate 
##                    FALSE                    FALSE                     TRUE 
##                      hdi      economic_crime_rate           personnel_rate 
##                     TRUE                     TRUE                     TRUE 
##       trafficked_victims alcohol_consumption_rate 
##                    FALSE                    FALSE</code></pre>
</div>
<div id="predict-homicide-rate-with-cp" class="section level3">
<h3>Predict Homicide Rate with Cp</h3>
<pre class="r"><code>homicide_best_subset_Cp &lt;- 
  best_subset(predictor = homicide_predictors, outcome = homicide_outcome, 
              criterion = &quot;Cp&quot;)

homicide_best_subset_Cp</code></pre>
<pre><code>## $Criterion
## [1] 2.512865
## 
## $Variable_Selection
##                      gdp           inflation_rate        unemployment_rate 
##                    FALSE                    FALSE                    FALSE 
##                      hdi      economic_crime_rate           personnel_rate 
##                     TRUE                     TRUE                     TRUE 
##       trafficked_victims alcohol_consumption_rate 
##                    FALSE                    FALSE</code></pre>
</div>
<div id="collinearity-of-best-subset-homicide-model"
class="section level3">
<h3>Collinearity of Best-Subset Homicide Model</h3>
<pre class="r"><code>subset_homicide_lm &lt;- lm(homicide_rate ~ unemployment_rate + hdi + 
                           economic_crime_rate + personnel_rate, 
                         data = homicide_df)
summary(subset_homicide_lm)</code></pre>
<pre><code>## 
## Call:
## lm(formula = homicide_rate ~ unemployment_rate + hdi + economic_crime_rate + 
##     personnel_rate, data = homicide_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.3265 -0.6331 -0.1335  0.5938  3.0783 
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          -3.02937    0.34997  -8.656 2.87e-16 ***
## unemployment_rate    -0.12063    0.08725  -1.383 0.167818    
## hdi                 -18.50047    1.02730 -18.009  &lt; 2e-16 ***
## economic_crime_rate   0.12511    0.02286   5.474 9.21e-08 ***
## personnel_rate        0.09847    0.02671   3.687 0.000268 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.9551 on 305 degrees of freedom
## Multiple R-squared:  0.5716, Adjusted R-squared:  0.566 
## F-statistic: 101.8 on 4 and 305 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>subset_homicide_fitted &lt;- subset_homicide_lm[[&quot;fitted.values&quot;]]


vif_subset_homicide_model &lt;- car::vif(subset_homicide_lm)
vif_subset_homicide_model %&gt;% 
  tibble(
    variable = names(vif_subset_homicide_model),
    VIF = vif_subset_homicide_model
  ) %&gt;% 
  select(variable, VIF) %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">unemployment_rate</td>
<td align="right">1.042179</td>
</tr>
<tr class="even">
<td align="left">hdi</td>
<td align="right">1.964320</td>
</tr>
<tr class="odd">
<td align="left">economic_crime_rate</td>
<td align="right">2.127143</td>
</tr>
<tr class="even">
<td align="left">personnel_rate</td>
<td align="right">1.209558</td>
</tr>
</tbody>
</table>
<p>All variables have VIF value below 5, suggesting that there is no
multi-colinearity issue.</p>
</div>
</div>
<div id="interpretation-1" class="section level2">
<h2>Interpretation</h2>
<p>For <code>homicide_rate</code>, the results are not as
straightforward. The best model based on R-squared (0.57) is the model
with <code>unemployment_rate</code>, <code>hdi</code>,
<code>economic_crime_rate</code> and <code>personnel_rate</code> as
predictors. Howeover, based on the Cp criterion (2.51), itâ€™s the model
with <code>hdi</code>, <code>economic_crime_rate</code> and
<code>personnel_rate</code>.</p>
<p>Subsequently, we will choose four predictors since it has a
relatively high adjusted R-Squared (0.57) and we were interested in a
model that explains more variation in violence rates.</p>
</div>
</div>
<div id="model-comparison" class="section level1">
<h1><em>Model Comparison</em></h1>
<div id="create-training-and-testing-datasets" class="section level2">
<h2>Create Training and Testing Datasets</h2>
<pre class="r"><code>cv_df_violence &lt;- 
  modelr::crossv_mc(violence_df, 100)

cv_df_violence &lt;- cv_df_violence %&gt;% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )

cv_df_homicide &lt;-
  modelr::crossv_mc(homicide_df, 100)

cv_df_homicide &lt;- cv_df_homicide %&gt;% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )</code></pre>
</div>
<div id="fit-models" class="section level2">
<h2>Fit Models</h2>
<div id="violence" class="section level3">
<h3>Violence</h3>
<pre class="r"><code>cv_df_violence &lt;-
  cv_df_violence %&gt;% 
  mutate(
    MLR_all_var = map(train, \(df) lm(violence_rate ~ ., data = df)),
    MLR_best_subset = map(train, \(df) lm(violence_rate ~ gdp + inflation_rate + 
                          unemployment_rate + hdi + economic_crime_rate + personnel_rate +
                           alcohol_consumption_rate, data = df)),
    lasso = map(train, \(df) fit_glmnet(df, outcome = &quot;violence_rate&quot;, 
                                        alpha = 1,lambda = lambda))
  ) %&gt;% 
  mutate(
    rmse_all_var = map2_dbl(
      MLR_all_var, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_best_subset = map2_dbl(
      MLR_best_subset, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_lasso = map2_dbl(
      lasso, test, \(mod, test) rmse_glmnet(mod, test, &quot;violence_rate&quot;))
  ) %&gt;% 
  select(starts_with(&quot;rmse_&quot;))</code></pre>
</div>
<div id="homicide" class="section level3">
<h3>Homicide</h3>
<pre class="r"><code>cv_df_homicide &lt;-
  cv_df_homicide %&gt;% 
  mutate(
    MLR_all_var = map(train, \(df) lm(homicide_rate ~ ., data = df)),
    MLR_best_subset = map(train, \(df) lm(homicide_rate ~ unemployment_rate + 
                                            personnel_rate + hdi + economic_crime_rate, 
                                          data = df)),
    lasso = map(train, \(df) fit_glmnet(df, outcome = &quot;homicide_rate&quot;, 
                                        alpha = 1,lambda = lambda))
  ) %&gt;% 
  mutate(
    rmse_all_var = map2_dbl(
      MLR_all_var, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_best_subset = map2_dbl(
      MLR_best_subset, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_lasso = map2_dbl(
      lasso, test, \(mod, test) rmse_glmnet(mod, test, &quot;homicide_rate&quot;))
  ) %&gt;% 
  select(starts_with(&quot;rmse_&quot;))</code></pre>
</div>
</div>
<div id="comparing-the-rmse" class="section level2">
<h2>Comparing the RMSE</h2>
<div id="violence-1" class="section level3">
<h3>Violence</h3>
<pre class="r"><code>cv_df_violence %&gt;%
  pivot_longer(
    everything(),
    names_to = &quot;Model&quot;, 
    values_to = &quot;RMSE&quot;,
    names_prefix = &quot;rmse_&quot;
  ) %&gt;% 
  mutate(
    Model = fct_inorder(Model)
  ) %&gt;% 
  ggplot(aes(x = Model, y = RMSE)) +
  geom_violin() +
  ggtitle(&quot;RMSE by Model for Predicting Violence Rate&quot;) +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Examining the distribution of RMSEs for each of the 3 models for
predicting violence rate, we see that they are relatively similar. It
appears that the MLR including all predictor variables has greater
spread in lower RMSE values compared to the other two models.</p>
<p>The similarity in performance among all 3 models likely relates to
the few number of predictor variables that exist in our studied dataset.
In general, each of the 3 models will not differ by many predictor
variables, and therefore perform similarly. Comparing the 3 models, the
best subset regression model may be considered optimal as it reduces
model complexity, without the caveat of difficulty interpreting beta
coefficients, which occurs with lasso models.</p>
</div>
<div id="homicide-1" class="section level3">
<h3>Homicide</h3>
<pre class="r"><code>cv_df_homicide %&gt;%
  pivot_longer(
    everything(),
    names_to = &quot;Model&quot;, 
    values_to = &quot;RMSE&quot;,
    names_prefix = &quot;rmse_&quot;
  )%&gt;% 
  mutate(
    Model = fct_inorder(Model)
  ) %&gt;% 
  ggplot(aes(x = Model, y = RMSE)) +
  geom_violin() +
  ggtitle(&quot;RMSE by Model for Predicting Homicide Rate&quot;) +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Examining the 3 models we used to predict homicide rate, we see that
the distribution of RMSE across 100-fold cross-validation are nearly
identical. This is likely in regard to the few predictor variables
included in our dataset. In particular, with such few predictor
variables, lasso is likely not the most well-suited for this task, since
there is not a serious need to reduce model complexity. Consequently,
the number of variables included in each of the 3 models is similar, and
the difference of 1 or 2 included predictors between each of the models
does not produce a substantial change in model effectiveness. Comparing
the 3 models, the best subset regression model may be considered the
best as it reduces model complexity but maintains ease of
interpretationof beta coefficients, having a slightly greater spread in
lower RMSE values compared to the other two models, which is not as
noticeable.</p>
</div>
</div>
</div>
<div id="model-diagnostics" class="section level1">
<h1><em>Model Diagnostics</em></h1>
<div id="all-variables-included-mlr" class="section level2">
<h2>All Variables included MLR</h2>
<pre class="r"><code>baseline_hom_resid_df = 
  homicide_df |&gt;
  add_residuals(baseline_MLR_hom) |&gt;
  add_predictions(baseline_MLR_hom) 

baseline_viol_resid_df = 
  violence_df |&gt;
  add_residuals(baseline_MLR_viol) |&gt;
  add_predictions(baseline_MLR_viol) 

check_model(baseline_hom_resid_df, &quot;MLR All Predictors Homicide Rate&quot;) </code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-26-1.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<pre class="r"><code>check_model(baseline_viol_resid_df, &quot;MLR All Predictors Violence Rate&quot;)</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-26-3.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-26-4.png" width="672" />
Examining the QQ-plots for the MLRs with all predictor variables
included, we notice that our assumption of normality of residuals may be
violated, as there are many lower-bound and upper-bound outliers that do
not fall along the reference line. For the plots of fitted values versus
residuals, we see differing results based on whether homicide rate or
violence rate is the outcome variable. With homicide as the outcome
variable, we can see residuals oscillate above and below the reference
line, indicating approximate linearity of the relationship between the
predictors and the outcome variables. However, the greater variability
in the residuals as fitted values increase, suggests that we are seeing
heteroscedasticity. Regarding violence rate as the outcome variable, we
see both issues with heteroscedasticity and linearity.</p>
</div>
<div id="best-subset-mlr" class="section level2">
<h2>Best Subset MLR</h2>
<pre class="r"><code>subset_homicide_resid_df = 
  homicide_df |&gt;
  add_residuals(subset_homicide_lm) |&gt;
  add_predictions(subset_homicide_lm) 

subset_violence_resid_df = 
  violence_df |&gt;
  add_residuals(subset_violence_lm) |&gt;
  add_predictions(subset_violence_lm) 

check_model(subset_homicide_resid_df, &quot;MLR Best-Subset Homicide Rate&quot;)</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-27-1.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-27-2.png" width="672" /></p>
<pre class="r"><code>check_model(subset_violence_resid_df, &quot;MLR Best-Subset Violence Rate&quot;)</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-27-3.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-27-4.png" width="672" /></p>
<p>Examining the QQ-plots for the MLRs using the best-subset of
predictor variables, we once again notice that our assumption of
normality of residuals may be in violation, as there appear to many
lower-bound and upper-bound outliers that do not fall along the
reference line. For the fitted versus residuals plot for homicide rate,
we see violations of both linearity and homosecdascity. The equivalent
plot for violence rate presents similar concerns regarding
homoscedascity, but shows a greater spread of residuals along the
horizontal reference line, and therefore better implies linearity of
relationship between predictor variables and outcome.</p>
</div>
<div id="lasso-1" class="section level2">
<h2>Lasso</h2>
<pre class="r"><code>lasso_homicide_resid_df =
  lasso_homicide_resid |&gt; 
  pull(residuals) |&gt;
  bind_cols(lasso_predict_homicide) |&gt;
  rename(resid = &quot;...1&quot;, pred = &quot;...2&quot;)

lasso_violence_resid_df =
  lasso_violence_resid |&gt; 
  pull(residuals) |&gt;
  bind_cols(lasso_predict_violence) |&gt;
  rename(resid = &quot;...1&quot;, pred = &quot;...2&quot;)

check_model(lasso_homicide_resid_df, &quot;Lasso Homicide Rate&quot;)</code></pre>
<p><img src="regression_files/figure-html/warning-FALSE-1.png" width="672" /><img src="regression_files/figure-html/warning-FALSE-2.png" width="672" /></p>
<pre class="r"><code>check_model(lasso_violence_resid_df, &quot;Lasso Violence Rate&quot;)</code></pre>
<p><img src="regression_files/figure-html/warning-FALSE-3.png" width="672" /><img src="regression_files/figure-html/warning-FALSE-4.png" width="672" /></p>
<p>Consistent with results from the QQ-plots of the previous two MLR
models, lasso models for both homicide rate and violence rate show
potential violations of the assumption of normality, as many lower-bound
and upper-bound outlier residuals do not fall along the reference line.
For the fitted versus residuals plot of homicide and violence rates, we
see a very low possibility of heteroscedascity and non-linearity, since
the horizontal line crosses the value of zero, but this acceptable since
this deviation is very insignificant.</p>
</div>
</div>
<div id="conclusion" class="section level1">
<h1><em>Conclusion</em></h1>
<p>Based on our comparisons of RMSE, we can conclude that our
best-subset regression models are most accurate at predicting the
outcomes: (1) Violence Rate and (2) Homicide Rate.</p>
<p>The best-subset regression model for predicting violence rate yielded
an adjusted r-squared of 0.46 and included the following variables as
predictors: GDP, inflation rate, economic crime rate, hdi, unemployment
rate, personnel rate, and alcohol consumption rate. The best-subset
regression model for predicting homicide rate returned an r-squared of
0.57. The variables included in this model were unemployment rate, HDI,
economic crime rate and personnel rate.</p>
<p><strong>Below are some important interpretations of our findings,
based on the best-subset regression model for predicting homicide
rate:</strong></p>
<p>HDI (Coefficient = -18.50047), p-value &lt; 2e-16: A 1-unit increase
in the HDI results in a decrease of 18.50047 units in the transformed
homicide rate, holding all other variables constant. Since the p-value
is very small, HDI has a strong negative effect on the transformed
homicide rate.</p>
<p>Economic Crime Rate (Coefficient = 0.12511, p-value = 9.21e-08): A
1-unit increase in transformed economic crime rate results in an
increase of 0.12511 units in transformed homicide rate, holding all
other variables constant. The p-value is very small, indicating
statistical significance.</p>
<p>Personnel Rate (Coefficient = 0.09847, p-value = 0.000268): A 1-unit
increase in transformed personnel rate results in an increase of 0.09847
units in the transformed homicide rate, holding other predictors
constant. The small p-value (0.000268) also makes this effect
statistically significant. This is rather surprising, because we
believed an increase in personnel rate should decrease homicide rate.
However, because personnel rate is a variable that also includes judges,
this result might make sense.</p>
<p><strong>Here are some of our important findings based on the
best-subset regression model for predicting violence rate:</strong></p>
<p>Economic Crime Rate (coefficient: 0.43184, p-value: &lt; 2e-16) A
1-unit increase in the transformed economic crime rate results in an
increase of 0.43184 units in the transformed violence rate, holding all
other variables constant. The p-value is extremely small, indicating a
significant relationship. This is consistent with the model predicting
homicide rate.</p>
<p>GDP (coefficient: 0.33523, p-value: 3.22e-07) A 1-unit increase in
transformed GDP results in an increase of 0.33523 units in the
transformed violence rate, holding all other variables constant. The
p-value is very small, suggesting statistical significance. The
association between economic growth and violence is surprising because
we might previously associate higher crime with countries with lower
GDP. However, these results may suggest that GDP growth can exacerbate
inequality and drive violence.</p>
<p>Alcohol Consumption Rate (coefficient: -0.19195, p-value: 0.000146) A
1-unit increase in transformed alcohol consumption rate results in a
decrease of 0.19195 units in the transformed violence rate, holding all
other variables constant. The p-value is small (0.000146), indicating
statistical significance. This result was also unexpected because we
previously believed higher alcohol consumption would lead to an <a
href="https://pmc.ncbi.nlm.nih.gov/articles/PMC8729263/">increase in
violence</a>, since itâ€™s associated with aggression, mood and
personality disorders). This might be due to limitations in our data
quality.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
