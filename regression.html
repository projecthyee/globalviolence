<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>regression</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="cleaning.html">Data</a>
</li>
<li>
  <a href="eda.html">EDA</a>
</li>
<li>
  <a href="regression.html">Regression</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Shiny
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://yousmni3269.shinyapps.io/shiny/">Interactive Map</a>
    </li>
    <li>
      <a href="plotly.html">Shiny 2</a>
    </li>
    <li>
      <a href="plotly2.html">Shiny 3</a>
    </li>
  </ul>
</li>
<li>
  <a href="report.html">Project Report</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="aboutus.html">About Us</a>
</li>
<li>
  <a href="https://github.com/projecthyee/p8105_fp_violence">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<div id="regression" class="section level1">
<h1>Regression</h1>
<p>My An Huynh 2024-11-15</p>
</div>
<div id="data-source-scraping-method-cleaning" class="section level1">
<h1>Data: Source, Scraping Method &amp; Cleaning</h1>
<div id="source" class="section level2">
<h2>Source</h2>
<p>Since there are many determinants and indicators of violence, we
chose the indicators and outcomes that we thought were most interesting
and relevant in exploring violence from the following sources:</p>
<ul>
<li>International Monetary Fund (IMF)
<ul>
<li>Unemployment Rate</li>
</ul></li>
<li>United Nations Development Program (UNDP):
<ul>
<li>Human Development Index</li>
</ul></li>
<li>United Nations Office of Drugs and Crime (UNODC)
<ul>
<li>Corruption and Economic Crime</li>
<li>Criminal Justice Personnel</li>
<li>Drug Seizure (2018 - 2022)</li>
<li>Firearms Trafficking</li>
<li>Human Trafficking</li>
<li>Intentional Homicide</li>
<li>Violent and Sexual Crimes</li>
</ul></li>
<li>World Bank
<ul>
<li>Gross Domestic Product (GDP)</li>
<li>Inflation Rate (Measured by Consumer Price Index)</li>
</ul></li>
<li>World Health Organization (WHO)
<ul>
<li>Alcohol Consumption</li>
</ul></li>
</ul>
<p>Intentional homicide, and violent and sexual crimes were chosen as
the outcome variable to quantify violence.</p>
</div>
<div id="scraping-method" class="section level2">
<h2>Scraping Method</h2>
<p>The datasets were downloaded from the official websites of the
sources above. The names of the files were also changed accordingly for
clarity and to avoid confusion. For example, the alcohol consumption
data file was renamed from “data.csv” to “alcohol_consumption.csv”.</p>
</div>
<div id="cleaning" class="section level2">
<h2>Cleaning</h2>
<div id="economic-determinants" class="section level3">
<h3>Economic Determinants</h3>
<pre class="r"><code>gdp_df = 
  read_excel(
    path = &quot;data/worldbank/gdp.xls&quot;,
    sheet = &quot;Data&quot;,
    skip = 3,
    na = &quot;&quot;
  ) |&gt;
  dplyr::select(country = &quot;Country Code&quot;, &quot;2015&quot;:&quot;2023&quot;) |&gt;
  pivot_longer(
    &quot;2015&quot;:&quot;2023&quot;,
    names_to = &quot;year&quot;,
    values_to = &quot;gdp&quot;
  ) |&gt;
  janitor::clean_names() |&gt;
  mutate(year = as.numeric(year),
         country = countrycode(country, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) |&gt;
  drop_na()</code></pre>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `country = countrycode(...)`.
## Caused by warning:
## ! Some values were not matched unambiguously: AFE, AFW, ARB, CEB, CHI, CSS, EAP, EAR, EAS, ECA, ECS, EMU, EUU, FCS, HIC, HPC, IBD, IBT, IDA, IDB, IDX, INX, LAC, LCN, LDC, LIC, LMC, LMY, LTE, MEA, MIC, MNA, NAC, OED, OSS, PRE, PSS, PST, SAS, SSA, SSF, SST, TEA, TEC, TLA, TMN, TSA, TSS, UMC, WLD, XKX</code></pre>
<pre class="r"><code>inflation_df = 
  read_excel(
    path = &quot;data/worldbank/inflation_rate.xls&quot;,
    sheet = &quot;Data&quot;,
    skip = 3,
    na = &quot;&quot;
  ) |&gt;
  dplyr::select(country = &quot;Country Code&quot;, &quot;2015&quot;:&quot;2023&quot;) |&gt;
  pivot_longer(
    &quot;2015&quot;:&quot;2023&quot;,
    names_to = &quot;year&quot;,
    values_to = &quot;inflation_rate&quot;
  ) |&gt;
  janitor::clean_names() |&gt;
  mutate(year = as.numeric(year),
         country = countrycode(country, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) |&gt;
  drop_na()</code></pre>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `country = countrycode(...)`.
## Caused by warning:
## ! Some values were not matched unambiguously: AFE, AFW, ARB, CEB, CHI, CSS, EAP, EAR, EAS, ECA, ECS, EMU, EUU, FCS, HIC, HPC, IBD, IBT, IDA, IDB, IDX, INX, LAC, LCN, LDC, LIC, LMC, LMY, LTE, MEA, MIC, MNA, NAC, OED, OSS, PRE, PSS, PST, SAS, SSA, SSF, SST, TEA, TEC, TLA, TMN, TSA, TSS, UMC, WLD, XKX</code></pre>
<pre class="r"><code>unemployment_df =
  read_excel(
    path = &quot;data/imf/unemployment_rate.xls&quot;,
    range = &quot;A1:AY116&quot;,
    na = &quot;no data&quot;
  ) |&gt;
  dplyr::select(country = &quot;Unemployment rate (Percent)&quot;, &quot;2015&quot;:&quot;2023&quot;) |&gt;
  drop_na(country) |&gt;
  pivot_longer(
    &quot;2015&quot;:&quot;2023&quot;,
    names_to = &quot;year&quot;,
    values_to = &quot;unemployment_rate&quot;
  ) |&gt;
  janitor::clean_names() |&gt;
  mutate(year = as.numeric(year),
         country = countrycode(country, origin = &quot;country.name&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) 

human_development_df =
  read_csv(
    file = &quot;data/undp/human_development_index.csv&quot;,
    na = &quot;&quot;) |&gt;
  head(-11) |&gt;
  pivot_longer(
    &quot;hdi_2015&quot;:&quot;hdi_2022&quot;,
    names_to = &quot;year&quot;,
    values_to = &quot;human_development_index&quot;
  ) |&gt;
  janitor::clean_names() |&gt;
  dplyr::select(country = &quot;iso3&quot;, year, human_development_index) |&gt;
  mutate(year = str_replace_all(year, &quot;hdi_&quot;, &quot;&quot;),
         year = as.numeric(year),
         country = countrycode(country, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA))</code></pre>
<pre><code>## Rows: 206 Columns: 1076
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr    (4): iso3, country, hdicode, region
## dbl (1072): hdi_rank_2022, hdi_1990, hdi_1991, hdi_1992, hdi_1993, hdi_1994,...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div id="social-determinants" class="section level3">
<h3>Social Determinants</h3>
<pre class="r"><code>crime_rate_df = 
  read_excel(
    path = &quot;data/unodc/corruption_economic_crime.xlsx&quot;,
    skip = 2
  ) |&gt;
  janitor::clean_names() |&gt;
  filter(unit_of_measurement == &quot;Rate per 100,000 population&quot;) |&gt;
  mutate(year = as.numeric(year),
         iso3_code = str_replace_all(iso3_code, &quot;^GBR.*&quot;, &quot;GBR&quot;),
         iso3_code = str_replace_all(iso3_code, &quot;^IRQ.*&quot;, &quot;IRQ&quot;),
         country = countrycode(iso3_code, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) |&gt;
  group_by(country, region, year) |&gt;
  summarize(avg_crime_rate = mean(value))</code></pre>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `country = countrycode(...)`.
## Caused by warning:
## ! Some values were not matched unambiguously: XKX

## `summarise()` has grouped output by &#39;country&#39;, &#39;region&#39;. You can override using
## the `.groups` argument.</code></pre>
<pre class="r"><code>justice_personnel_df =
  read_excel(
    path = &quot;data/unodc/criminal_justice_personnel.xlsx&quot;,
    skip = 2
  ) |&gt;
  janitor::clean_names() |&gt;
  filter(indicator == &quot;Criminal Justice Personnel&quot;,
         unit_of_measurement == &quot;Rate per 100,000 population&quot;,
         sex == &quot;Total&quot;) |&gt;
  mutate(year = as.numeric(year),
         iso3_code = str_replace_all(iso3_code, &quot;^GBR.*&quot;, &quot;GBR&quot;),
         iso3_code = str_replace_all(iso3_code, &quot;^IRQ.*&quot;, &quot;IRQ&quot;),
         country = countrycode(iso3_code, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) |&gt;
  group_by(country, region, year) |&gt;
  summarize(avg_personnel_rate = mean(value))</code></pre>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `country = countrycode(...)`.
## Caused by warning:
## ! Some values were not matched unambiguously: XKX

## `summarise()` has grouped output by &#39;country&#39;, &#39;region&#39;. You can override using
## the `.groups` argument.</code></pre>
<pre class="r"><code>drugs_2018_2022_df =
  read_excel(
    path = &quot;data/unodc/drug_seizures_2018_2022.xlsx&quot;,
    skip = 1
  ) |&gt;
  janitor::clean_names() |&gt;
  rename(year = reference_year) |&gt;
  mutate(year = as.numeric(year),
         country = countrycode(ms_code, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) |&gt;
  group_by(country, region, year) |&gt;
  summarize(total_drug_seizures = sum(kilograms))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;country&#39;, &#39;region&#39;. You can override using
## the `.groups` argument.</code></pre>
<pre class="r"><code>firearms_df = 
    read_excel(
    path = &quot;data/unodc/firearms_trafficking.xlsx&quot;,
    skip = 2
  ) |&gt;
  janitor::clean_names() |&gt;
  mutate(year = as.numeric(year),
         iso3_code = str_replace_all(iso3_code, &quot;^GBR.*&quot;, &quot;GBR&quot;),
         iso3_code = str_replace_all(iso3_code, &quot;^IRQ.*&quot;, &quot;IRQ&quot;),
         country = countrycode(iso3_code, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) |&gt;
  filter(indicator == &quot;Arms seized&quot;,
         category == &quot;Total&quot;) |&gt;
  group_by(country, region, year) |&gt;
  summarize(total_arms_seized = sum(value))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;country&#39;, &#39;region&#39;. You can override using
## the `.groups` argument.</code></pre>
<pre class="r"><code>trafficking_df =
  read_excel(
    path = &quot;data/unodc/human_trafficking.xlsx&quot;,
    skip = 2
  ) |&gt;
  janitor::clean_names() |&gt;
  filter(category == &quot;Total&quot;,
         sex == &quot;Total&quot;,
         age == &quot;Total&quot;,
         txt_value != &quot;&lt;5&quot;) |&gt;
  mutate(txt_value = str_replace_all(txt_value, &quot;,&quot;, &quot;&quot;),
         txt_value = as.numeric(txt_value), 
         year = as.numeric(year), 
         country = countrycode(iso3_code, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) |&gt;
  group_by(country, region, year) |&gt;
  summarize(total_trafficking = sum(txt_value))</code></pre>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `country = countrycode(...)`.
## Caused by warning:
## ! Some values were not matched unambiguously: CAR, CAS, EEU, MCA, MCN, SAF, SAM

## `summarise()` has grouped output by &#39;country&#39;, &#39;region&#39;. You can override using
## the `.groups` argument.</code></pre>
<pre class="r"><code>alcohol_consumption_df =
  read_csv(
    file = &quot;data/who/alcohol_consumption.csv&quot;, 
    na = &quot;&quot;
  ) |&gt;
  janitor::clean_names() |&gt;
  filter(dim1 == &quot;Both sexes&quot;) |&gt;
  dplyr::select(country = spatial_dim_value_code, year = period, 
         alcohol_consumption = fact_value_numeric) |&gt;
  mutate(year = as.numeric(year),
         country = countrycode(country, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA))</code></pre>
<pre><code>## Rows: 11799 Columns: 34
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (15): IndicatorCode, Indicator, ValueType, ParentLocationCode, ParentLo...
## dbl   (4): Period, FactValueNumeric, FactValueNumericLow, FactValueNumericHigh
## lgl  (14): IsLatestYear, Dim2 type, Dim2, Dim2ValueCode, Dim3 type, Dim3, Di...
## dttm  (1): DateModified
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div id="outcomes-of-violence" class="section level3">
<h3>Outcomes of Violence</h3>
<pre class="r"><code>homicide_rate_df = 
    readxl::read_excel(
    path = &quot;data/unodc/intentional_homicide.xlsx&quot;,
    skip = 2
  ) |&gt;
  janitor::clean_names() |&gt;
  filter(indicator == &quot;Victims of intentional homicide&quot;,
         unit_of_measurement == &quot;Rate per 100,000 population&quot;,
         dimension == &quot;Total&quot;,
         sex == &quot;Total&quot;,
         age == &quot;Total&quot;) |&gt;
  mutate(year = as.numeric(year),
         iso3_code = str_replace_all(iso3_code, &quot;^GBR.*&quot;, &quot;GBR&quot;),
         iso3_code = str_replace_all(iso3_code, &quot;^IRQ.*&quot;, &quot;IRQ&quot;),
         country = countrycode(iso3_code, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) |&gt;
  dplyr::select(country, region, year, homicide_rate = value)</code></pre>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `country = countrycode(...)`.
## Caused by warning:
## ! Some values were not matched unambiguously: XKX</code></pre>
<pre class="r"><code>violence_rate_df = 
    readxl::read_excel(
    path = &quot;data/unodc/violent_sexual_crime.xlsx&quot;,
    skip = 2
  ) |&gt;
  janitor::clean_names() |&gt;
  filter(indicator == &quot;Violent offences&quot;,
         unit_of_measurement == &quot;Rate per 100,000 population&quot;) |&gt;
  pivot_wider(
    names_from = indicator,
    values_from = value
  ) |&gt;
  rename(violence_rate = &quot;Violent offences&quot;) |&gt;
  mutate(year = as.numeric(year),
         iso3_code = str_replace_all(iso3_code, &quot;^GBR.*&quot;, &quot;GBR&quot;),
         iso3_code = str_replace_all(iso3_code, &quot;^IRQ.*&quot;, &quot;IRQ&quot;),
         country = countrycode(iso3_code, origin = &quot;iso3c&quot;,
                               destination = &quot;country.name&quot;,
                               nomatch = NA)) |&gt;
  group_by(country, year) |&gt;
  summarize(avg_violence_rate = mean(violence_rate)) </code></pre>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `country = countrycode(...)`.
## Caused by warning:
## ! Some values were not matched unambiguously: XKX

## `summarise()` has grouped output by &#39;country&#39;. You can override using the
## `.groups` argument.</code></pre>
<p>For the economic determinants, all the datasets had years organized
as different columns, where each column represented values for that
specific year. Therefore, pivot_longer() was applied to pivot years and
their respective values into two columns.</p>
<p>For rates of all social determinants, we filtered and chose the data
to be rates per 100,000 people since it allows standardization for
comparability by adjusting for differences in population size.</p>
<p>The countrycode() function from the countrycode package was also
implemented in order to standardize the country names of each dataset
since some of the country names were represented inconsistently across
datasets. For example, South Korea was represented as “Korea (Republic
of)” and “Korea, Rep.”</p>
</div>
<div id="merge-datasets" class="section level3">
<h3>Merge Datasets</h3>
<pre class="r"><code>merged_violence_df =
  left_join(homicide_rate_df, violence_rate_df) |&gt;
  left_join(gdp_df) |&gt;
  left_join(inflation_df) |&gt;
  left_join(unemployment_df) |&gt;
  left_join(human_development_df) |&gt;
  left_join(crime_rate_df) |&gt;
  left_join(justice_personnel_df) |&gt;
  left_join(drugs_2018_2022_df) |&gt;
  left_join(firearms_df) |&gt;
  left_join(trafficking_df) |&gt;
  left_join(alcohol_consumption_df) |&gt;
  mutate(country = as.factor(country),
         region = as.factor(region)) |&gt;
  filter(between(year, 2015, 2023)) |&gt;
  drop_na(country, region)</code></pre>
<pre><code>## Joining with `by = join_by(country, year)`
## Joining with `by = join_by(country, year)`
## Joining with `by = join_by(country, year)`
## Joining with `by = join_by(country, year)`
## Joining with `by = join_by(country, year)`
## Joining with `by = join_by(country, region, year)`
## Joining with `by = join_by(country, region, year)`
## Joining with `by = join_by(country, region, year)`
## Joining with `by = join_by(country, region, year)`
## Joining with `by = join_by(country, region, year)`
## Joining with `by = join_by(country, year)`</code></pre>
<pre class="r"><code>str(merged_violence_df)</code></pre>
<pre><code>## tibble [1,028 × 15] (S3: tbl_df/tbl/data.frame)
##  $ country                : Factor w/ 199 levels &quot;Afghanistan&quot;,..: 1 6 2 5 188 9 10 4 12 13 ...
##  $ region                 : Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 1 4 4 3 2 3 5 5 4 ...
##  $ year                   : num [1:1028] 2015 2015 2015 2015 2015 ...
##  $ homicide_rate          : num [1:1028] 9.975 4.458 2.22 0 0.673 ...
##  $ avg_violence_rate      : num [1:1028] NA NA 5.51 41.26 2.16 ...
##  $ gdp                    : num [1:1028] 1.91e+10 9.05e+10 1.14e+10 2.79e+09 3.70e+11 ...
##  $ inflation_rate         : num [1:1028] -0.662 9.356 1.896 NA 4.07 ...
##  $ unemployment_rate      : num [1:1028] NA NA 17.1 3.9 NA 6.5 18.5 NA 6.1 6.2 ...
##  $ human_development_index: num [1:1028] 0.479 0.591 0.797 0.856 0.86 0.85 0.769 NA 0.933 0.91 ...
##  $ avg_crime_rate         : num [1:1028] NA NA 25.9 784.7 31.9 ...
##  $ avg_personnel_rate     : num [1:1028] NA NA 165 148 NA ...
##  $ total_drug_seizures    : num [1:1028] NA NA NA NA NA NA NA NA NA NA ...
##  $ total_arms_seized      : num [1:1028] NA NA NA NA NA NA NA NA NA NA ...
##  $ total_trafficking      : num [1:1028] NA NA 109 NA 34 ...
##  $ alcohol_consumption    : num [1:1028] 0.009 7.76 5.04 10.76 2.37 ...</code></pre>
<p>The final merged dataset includes 1028 rows and 15 columns, including
country, region, year, homicide rate, average violence offence rate,
gdp, inflation rate, unemployment rate, average crime rate, average
(criminal justice) personnel rate, total drug seized (2018 - 2022),
total arm seized, total trafficking and alcohol consumption as
variables. There is a total of 163 distinct countries.</p>
<p>After merging the datasets, country and region were converted to
categorical variables. Rows with NA values for country and region were
dropped, and the dataset was filtered for the years between 2015 and
2023.</p>
</div>
</div>
<div id="regression-1" class="section level2">
<h2>Regression</h2>
<p>Split data into training and testing + visualize distributions</p>
<pre class="r"><code>train_df = sample_frac(merged_violence_df, size = 0.8)
test_df = anti_join(merged_violence_df, train_df, by = &quot;gdp&quot;)

train_df |&gt; 
  ggplot(aes(x = homicide_rate)) +
  geom_density()</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-1.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = avg_violence_rate)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 196 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-2.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = gdp)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 20 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-3.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = inflation_rate)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 83 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-4.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = unemployment_rate)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 239 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-5.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = avg_crime_rate)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 215 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-6.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = human_development_index)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 60 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-7.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = avg_crime_rate)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 215 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-8.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = avg_personnel_rate)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 384 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-9.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = total_drug_seizures)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 487 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-10.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = total_arms_seized)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 574 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-11.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = total_trafficking)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 353 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-12.png" /><!-- --></p>
<pre class="r"><code>train_df |&gt; 
  ggplot(aes(x = alcohol_consumption)) +
  geom_density()</code></pre>
<pre><code>## Warning: Removed 240 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img
src="regression_files/figure-gfm/train/test%20+%20visualization-13.png" /><!-- --></p>
<p>After looking at the distributions of all variables, all variables
are skewed right, except for human development index which is slightly
skewed left. I will apply ln transformations and box-cox transformations
to these variables, and use the Shapiro-Wilk test to test for normality.
Even though it is not necessary to normalize the predictors, this step
will stablize variance and reduce heteroscedasticity. I think it will be
helpful for further steps with model.</p>
<p>Transformation step involves writing a function for ln transformation
and a function for box_cox transformation. The functions will be mapped
into the nested listcol which includes all continuous variables in the
train_df dataset.</p>
<pre class="r"><code>ln_transform = function(df) {
  df |&gt; 
    mutate(across(everything(), ~ {
      if(any(!is.na(.) &amp; . &lt;= 0)) {
      . = . + abs(min(., na.rm = TRUE) + 0.0000000001)
    }
      log(.)
    }))
}</code></pre>
<p>Working on box cox but the code doesn’t work …</p>
<pre class="r"><code>box_cox_transform = function(df) {
  df |&gt; 
    mutate(across(where(is.numeric), ~ {
      if (any(!is.na(.) &amp; . &lt;= 0)) {
        . &lt;- . + min(., na.rm = TRUE) + 0.0000000001  
      }

      box_cox_result &lt;- boxcox(. ~ 1, lambda = &quot;all&quot;, plotit = FALSE)

      box_cox_tidy &lt;- tidy(box_cox_result)
      
      optimal_lambda &lt;- box_cox_tidy |&gt; 
        filter(logLik == max(logLik)) |&gt; 
        pull(lambda) 
      
      if (optimal_lambda == 0) {
        log(.) 
      } else {
        ((.)^optimal_lambda - 1) / optimal_lambda  
      }
    }))
}</code></pre>
<pre class="r"><code>nested_train_df =
  train_df |&gt; 
  nest(data = c(homicide_rate:alcohol_consumption)) |&gt; 
  mutate(
    ln_transformed_data = map(data, ln_transform)
    #Can add box cox code here
  ) |&gt; 
  unnest(ln_transformed_data) |&gt; 
  rename_with(~ paste0(&quot;ln_&quot;, .), where(is.numeric)) |&gt; 
  rename(
    year = ln_year
  ) </code></pre>
<pre><code>## Warning: There were 76 warnings in `mutate()`.
## The first warning was:
## ℹ In argument: `across(...)`.
## Caused by warning:
## ! There was 1 warning in `mutate()`.
## ℹ In argument: `across(...)`.
## Caused by warning in `log()`:
## ! NaNs produced
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 75 remaining warnings.</code></pre>
<pre class="r"><code>nested_train_df =
  nested_train_df |&gt; 
  dplyr::select(country, year, region, starts_with(&quot;ln&quot;))</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
