<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Regression</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="cleaning.html">Data</a>
</li>
<li>
  <a href="eda.html">EDA</a>
</li>
<li>
  <a href="regression.html">Regression</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Shiny &amp; Dashboard
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://yousmni3269.shinyapps.io/shiny_prevalence/">Prevalence of Violence</a>
    </li>
    <li>
      <a href="https://yousmni3269.shinyapps.io/shiny_trend/">Trends of Violence</a>
    </li>
    <li>
      <a href="plotly_vs.html">Homicide vs. Violence</a>
    </li>
  </ul>
</li>
<li>
  <a href="p8105_fp_report.html">Project Report</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="aboutus.html">About Us</a>
</li>
<li>
  <a href="https://github.com/projecthyee/p8105_fp_violence">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Regression</h1>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Our motivation for doing regression is to determine the significant
contributors to two outcomes of violence - homicide rate and violence
rate.</p>
<p>Violence is a complex and multifaceted issue, especially when
considered in a global context. To better understand its various
dimensions, we aimed to include a diverse set of predictors that reflect
different underlying factors driving violence. Specifically, economic
indicators like GDP, inflation rate, and the Human Development Index
(HDI) capture aspects of economic inequality, which can influence social
unrest and violence. Crime rate and personnel rate serve as proxies for
the level of criminal activity and law enforcement presence,
respectively, which can contribute to both non-violent and violent
crime. Additionally, trafficked victims and alcohol consumption rate are
included to explore the role of cultural norms and behaviors, such as
organized crime, substance abuse, and social vulnerability, which can be
key drivers of violence.</p>
<p>We hypothesize that homicide rate may be influenced by more “direct”
indicators including crime rate, HDI and trafficked_victims. We
hypothesize that violence rate may be influenced by all factors we
included in this dataset, because violence can exist in multiple
forms.</p>
<p>We perform this analysis to uncover the extent to which different
factors influence homicide rate and violence rate as outcomes.</p>
</div>
<div id="functions-for-fitting-data" class="section level1">
<h1>Functions for Fitting Data</h1>
<div id="best_subset" class="section level2">
<h2>Best_subset</h2>
<pre class="r"><code>best_subset = function(predictor, outcome, criterion) {
  
  optimal_subset &lt;- 
    leaps(x = predictor, y = outcome, nbest = 3, 
      method = criterion, names = names(predictor))
  
  if (criterion == &quot;Cp&quot;) {
    optimal_criterion &lt;- optimal_subset[[criterion]] %&gt;% min()
    optimal_subset_idx &lt;- optimal_subset[[criterion]] %&gt;% which.min()
    
  } else {
    optimal_criterion &lt;- optimal_subset[[criterion]] %&gt;% max()
    optimal_subset_idx &lt;- optimal_subset[[criterion]] %&gt;% which.max()
  }
  
  
  list(Criterion = optimal_criterion , 
       Variable_Selection = optimal_subset$which[optimal_subset_idx,])
  
}</code></pre>
<p>This function serves as a wrapper around the leaps function. It
performs best subset variable selection and then prints out the optimal
model diagnostic and the predictor variables included in the regression
model.</p>
</div>
<div id="fit_glmnet" class="section level2">
<h2>fit_glmnet</h2>
<pre class="r"><code>fit_glmnet = function(df, alpha, outcome, lambda) {
  
  outcome_formula &lt;- as.formula(paste(outcome, &quot;~.&quot;))
  predictor &lt;- model.matrix(outcome_formula, data = df)[,-1]
  predicted &lt;- df %&gt;% pull(outcome)
  
  model_fit &lt;- 
    glmnet(predictor, predicted, lambda = lambda, alpha = alpha)
  
  model_cv &lt;-
    cv.glmnet(predictor, predicted, lambda = lambda, alpha = alpha)
  
  lambda_opt = model_cv[[&quot;lambda.min&quot;]]
  
  model_fit &lt;-
    glmnet(predictor, predicted, lambda = lambda_opt, alpha = alpha)
  
  return(model_fit)
  
}</code></pre>
<p>This function serves as a wrapper for the glmnet fitting processing
and covers both the fitting and cross-validation process. It returns the
glmnet object produced after fitting with optimal lambda value.</p>
</div>
<div id="rmse_glmnet" class="section level2">
<h2>rmse_glmnet</h2>
<pre class="r"><code>rmse_glmnet = function(model, test, outcome) {
  outcome_formula &lt;- as.formula(paste(outcome, &quot;~.&quot;))
  predictor &lt;- model.matrix(outcome_formula, data = test)[,-1]
  predictions &lt;- predict.glmnet(model, model[[&quot;lambda&quot;]], newx = predictor,
                               type = &quot;response&quot;)
  
  predictions &lt;- as.vector(predictions)
  observed &lt;- test %&gt;% 
    pull(outcome)
  
  return(caret::RMSE(predictions, observed))
  
}</code></pre>
<p>This is a wrapper function for the glmnet prediction and evaluation
process. Given a fitted glmnet model, a test dataset, and an outcome
variable of interest, this function predicts the avlues in the test
dataset and then calculates and returns the rmse.</p>
</div>
</div>
<div id="exploratory-data-analysis" class="section level1">
<h1>Exploratory data analysis</h1>
<div id="visualizations-of-distributions" class="section level2">
<h2>Visualizations of distributions</h2>
<pre class="r"><code>plot_distributions = function(column, name) {
  if(is.numeric(column) &amp; name != &quot;year&quot;) {
    plot = ggplot(merged_violence_df, aes(x = column)) +
            geom_density() +
            labs(title = paste(&quot;Distribution of&quot;, name))
  }
}

list = colnames(merged_violence_df)
map(list, \(x) plot_distributions(pull(merged_violence_df, x), x))</code></pre>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## NULL
## 
## [[4]]
## NULL
## 
## [[5]]</code></pre>
<p><img src="regression_files/figure-html/distributions-1.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="regression_files/figure-html/distributions-2.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<pre><code>## Warning: Removed 6 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/distributions-3.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<pre><code>## Warning: Removed 46 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/distributions-4.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<pre><code>## Warning: Removed 42 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/distributions-5.png" width="672" /></p>
<pre><code>## 
## [[10]]</code></pre>
<pre><code>## Warning: Removed 20 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/distributions-6.png" width="672" /></p>
<pre><code>## 
## [[11]]</code></pre>
<pre><code>## Warning: Removed 31 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/distributions-7.png" width="672" /></p>
<pre><code>## 
## [[12]]</code></pre>
<pre><code>## Warning: Removed 246 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/distributions-8.png" width="672" /></p>
<pre><code>## 
## [[13]]</code></pre>
<pre><code>## Warning: Removed 298 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/distributions-9.png" width="672" /></p>
<pre><code>## 
## [[14]]</code></pre>
<pre><code>## Warning: Removed 211 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/distributions-10.png" width="672" /></p>
<p>All variables are skewed right, except for human development index
which is bimodal and slightly left-skewed. We will apply ln
transformations and Box-Cox transformations to these variables. Even
though it is not necessary to normalize the distribution of predictors,
this step will stabilize variance and reduce heteroscedasticity. We
believe it will be helpful for further steps with model.</p>
</div>
<div id="transformations" class="section level2">
<h2>Transformations</h2>
<p>Transformation step involves writing a function for natural log
transformation and a function for Box-Cox transformation. The functions
will be mapped into the nested list col which includes all continuous
variables in the <code>merged_violence_df</code> dataset.</p>
</div>
<div id="natural-log-transform." class="section level2">
<h2>Natural Log Transform.</h2>
<pre class="r"><code>ln_transform = function(value) {
  return(log(abs(value)))
}

ln_df = 
  merged_violence_df |&gt;
  mutate(across(c(homicide_rate:alcohol_consumption_rate), 
                ln_transform))

map(list, \(x) plot_distributions(pull(ln_df, x), x))</code></pre>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## NULL
## 
## [[4]]
## NULL
## 
## [[5]]</code></pre>
<pre><code>## Warning: Removed 6 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-1.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<pre><code>## Warning: Removed 3 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-2.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<pre><code>## Warning: Removed 6 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-3.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<pre><code>## Warning: Removed 46 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-4.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<pre><code>## Warning: Removed 42 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-5.png" width="672" /></p>
<pre><code>## 
## [[10]]</code></pre>
<pre><code>## Warning: Removed 20 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-6.png" width="672" /></p>
<pre><code>## 
## [[11]]</code></pre>
<pre><code>## Warning: Removed 38 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-7.png" width="672" /></p>
<pre><code>## 
## [[12]]</code></pre>
<pre><code>## Warning: Removed 246 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-8.png" width="672" /></p>
<pre><code>## 
## [[13]]</code></pre>
<pre><code>## Warning: Removed 298 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-9.png" width="672" /></p>
<pre><code>## 
## [[14]]</code></pre>
<pre><code>## Warning: Removed 213 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/ln-transform-10.png" width="672" /></p>
</div>
<div id="box-cox-transform." class="section level2">
<h2>Box-Cox Transform.</h2>
<pre class="r"><code>boxcox_transform = function(value) {
  if (all(is.na(value))) {
    return(value) 
  }

  min_value = min(value, na.rm = TRUE) 
  if (min_value &lt;= 0) {
    value = value + abs(min_value) + 0.00001  
  }

  if (length(unique(value)) == 1) {
    return(value) 
  }

  boxcox_result = boxcox(value ~ 1, plotit = FALSE)
  lambda = boxcox_result$x[which.max(boxcox_result$y)]  


  transformed_value = (value^lambda - 1) / lambda
  return(transformed_value)
}


boxcox_df = merged_violence_df |&gt; 
  mutate(across(c(homicide_rate:alcohol_consumption_rate), 
                ~ boxcox_transform(.)))

map(list, \(x) plot_distributions(pull(boxcox_df, x), x))</code></pre>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## NULL
## 
## [[4]]
## NULL
## 
## [[5]]</code></pre>
<p><img src="regression_files/figure-html/boxcox-1.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="regression_files/figure-html/boxcox-2.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<pre><code>## Warning: Removed 771 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/boxcox-3.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<pre><code>## Warning: Removed 46 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/boxcox-4.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<pre><code>## Warning: Removed 42 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/boxcox-5.png" width="672" /></p>
<pre><code>## 
## [[10]]</code></pre>
<pre><code>## Warning: Removed 20 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/boxcox-6.png" width="672" /></p>
<pre><code>## 
## [[11]]</code></pre>
<pre><code>## Warning: Removed 31 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/boxcox-7.png" width="672" /></p>
<pre><code>## 
## [[12]]</code></pre>
<pre><code>## Warning: Removed 246 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/boxcox-8.png" width="672" /></p>
<pre><code>## 
## [[13]]</code></pre>
<pre><code>## Warning: Removed 298 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/boxcox-9.png" width="672" /></p>
<pre><code>## 
## [[14]]</code></pre>
<pre><code>## Warning: Removed 211 rows containing non-finite outside the scale range
## (`stat_density()`).</code></pre>
<p><img src="regression_files/figure-html/boxcox-10.png" width="672" /></p>
<p>While initial EDA suggested that logarithmic and Box-Cox
transformations might be useful for improving normality, the results
indicate that these transformations are not entirely necessary. The
primary motivation for using these transformations is often to address
skewness. However, after reviewing the data and the results of the
transformations, we found that the original data already provides a
reasonable representation of the underlying distribution.</p>
<p>While the natural logarithm helped with normality, the Box-Cox
transformation did not substantially improve the data’s distribution.
Box-Cox transformation requires shifting data to be strictly positive,
which could introduce unnecessary complexity.</p>
<p>Since no major improvements in normality were observed with the
transformations, we ultimately decided that it would be more appropriate
to use the original data. This approach avoids unnecessary manipulation
and preserves the integrity of the underlying data.</p>
</div>
<div id="multicolliniearity-diagnostics" class="section level2">
<h2>Multicolliniearity diagnostics</h2>
<p>We used <code>cor()</code> to find the correlation between the eight
predictors of homicide rate and violence.
<img src="regression_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>There is moderate correlation between <code>hdi</code> and
<code>alcohol_consumption_rate</code>, corr = 0.5, and moderately high
correlation between <code>trafficked_victims</code> and
<code>gdp</code>, corr = 0.7.</p>
</div>
</div>
<div id="data-pre-processing" class="section level1">
<h1>Data Pre-processing</h1>
<p>In this step, we manipulate the merged_violence_df in preparation for
later statistical modelling.</p>
<div id="define-lambda-range" class="section level2">
<h2>Define Lambda Range</h2>
<pre class="r"><code>lambda = 10^(seq(-2, 2.75, 0.1))</code></pre>
</div>
<div id="pre-processing-for-homicide." class="section level2">
<h2>Pre-processing for homicide.</h2>
<pre class="r"><code>homicide_df =
  merged_violence_df |&gt; 
  dplyr::ungroup() |&gt; 
  dplyr::select(
    homicide_rate, everything(), -violence_rate, -year, -country, -region, 
    -iso3_code) |&gt; 
  drop_na()

homicide_matrix &lt;- model.matrix(homicide_rate ~., data = homicide_df)[,-1]

homicide_predictors &lt;- homicide_df %&gt;% 
  dplyr::select(-homicide_rate)

homicide_outcome &lt;- homicide_df %&gt;% 
  pull(homicide_rate)</code></pre>
</div>
<div id="pre-processing-for-violence." class="section level2">
<h2>Pre-processing for violence.</h2>
<pre class="r"><code>violence_df =
  merged_violence_df |&gt; 
  dplyr::ungroup() |&gt; 
  dplyr::select(
    violence_rate, everything(), -year, -homicide_rate, -country, -region, 
    -iso3_code) |&gt;
  drop_na()

violence_matrix &lt;- model.matrix(violence_rate ~., data = violence_df)[,-1]
  
violence_predictors &lt;- violence_df %&gt;% 
  dplyr::select(-violence_rate)

violence_outcome &lt;- violence_df %&gt;% 
  pull(violence_rate)</code></pre>
</div>
</div>
<div id="baseline-mlr-with-additive-effects" class="section level1">
<h1>Baseline MLR with additive effects</h1>
<p>First, we will fit a baseline MLR with additive effects from all
possible predictor variables to use as a point of reference for our
modeling process. This step provides basic understanding of the extent
to which different covariates contribute to the outcomes of
interest.</p>
<div id="predict-homicide-rates" class="section level2">
<h2>Predict Homicide Rates</h2>
<table>
<colgroup>
<col width="36%" />
<col width="17%" />
<col width="14%" />
<col width="16%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">77.1223904</td>
<td align="right">6.8949976</td>
<td align="right">11.1852672</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.4401126</td>
<td align="right">0.1508748</td>
</tr>
<tr class="odd">
<td align="left">inflation_rate</td>
<td align="right">-0.7310164</td>
<td align="right">0.1997345</td>
<td align="right">-3.6599403</td>
<td align="right">0.0002978</td>
</tr>
<tr class="even">
<td align="left">unemployment_rate</td>
<td align="right">-0.3801340</td>
<td align="right">0.1437800</td>
<td align="right">-2.6438594</td>
<td align="right">0.0086262</td>
</tr>
<tr class="odd">
<td align="left">hdi</td>
<td align="right">-79.7616365</td>
<td align="right">9.3579304</td>
<td align="right">-8.5234270</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">crime_rate</td>
<td align="right">0.0047858</td>
<td align="right">0.0037406</td>
<td align="right">1.2793927</td>
<td align="right">0.2017441</td>
</tr>
<tr class="odd">
<td align="left">personnel_rate</td>
<td align="right">0.0090816</td>
<td align="right">0.0064515</td>
<td align="right">1.4076778</td>
<td align="right">0.1602584</td>
</tr>
<tr class="even">
<td align="left">trafficked_victims</td>
<td align="right">-0.0004297</td>
<td align="right">0.0005839</td>
<td align="right">-0.7358718</td>
<td align="right">0.4623817</td>
</tr>
<tr class="odd">
<td align="left">alcohol_consumption_rate</td>
<td align="right">-0.2165605</td>
<td align="right">0.2052374</td>
<td align="right">-1.0551708</td>
<td align="right">0.2921934</td>
</tr>
</tbody>
</table>
<p>Results from baseline MLR show that that inflation rate, unemployment
rate and hdi are significant predictors of homicide rate at significance
level alpha = 0.05.</p>
</div>
<div id="check-baseline-homicide-prediction-model-for-colinearity"
class="section level2">
<h2>Check Baseline Homicide Prediction Model for Colinearity</h2>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gdp</td>
<td align="right">2.396884</td>
</tr>
<tr class="even">
<td align="left">inflation_rate</td>
<td align="right">1.176607</td>
</tr>
<tr class="odd">
<td align="left">unemployment_rate</td>
<td align="right">1.164411</td>
</tr>
<tr class="even">
<td align="left">hdi</td>
<td align="right">2.455203</td>
</tr>
<tr class="odd">
<td align="left">crime_rate</td>
<td align="right">1.700020</td>
</tr>
<tr class="even">
<td align="left">personnel_rate</td>
<td align="right">1.306548</td>
</tr>
<tr class="odd">
<td align="left">trafficked_victims</td>
<td align="right">2.315171</td>
</tr>
<tr class="even">
<td align="left">alcohol_consumption_rate</td>
<td align="right">1.896571</td>
</tr>
</tbody>
</table>
<p>Results from VIF show that there is no multicollinearity issue (VIF
&lt; 5).</p>
</div>
<div id="predict-violence-rates" class="section level2">
<h2>Predict Violence Rates</h2>
<table>
<colgroup>
<col width="36%" />
<col width="17%" />
<col width="15%" />
<col width="15%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">44.2045930</td>
<td align="right">19.9655911</td>
<td align="right">2.2140388</td>
<td align="right">0.0275754</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">2.7199674</td>
<td align="right">0.0069083</td>
</tr>
<tr class="odd">
<td align="left">inflation_rate</td>
<td align="right">-2.0163975</td>
<td align="right">0.5783639</td>
<td align="right">-3.4863818</td>
<td align="right">0.0005625</td>
</tr>
<tr class="even">
<td align="left">unemployment_rate</td>
<td align="right">-0.1171670</td>
<td align="right">0.4163384</td>
<td align="right">-0.2814226</td>
<td align="right">0.7785796</td>
</tr>
<tr class="odd">
<td align="left">hdi</td>
<td align="right">-12.9837171</td>
<td align="right">27.0974152</td>
<td align="right">-0.4791497</td>
<td align="right">0.6321801</td>
</tr>
<tr class="even">
<td align="left">crime_rate</td>
<td align="right">0.1193201</td>
<td align="right">0.0108316</td>
<td align="right">11.0158771</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">personnel_rate</td>
<td align="right">-0.0628082</td>
<td align="right">0.0186813</td>
<td align="right">-3.3620841</td>
<td align="right">0.0008735</td>
</tr>
<tr class="even">
<td align="left">trafficked_victims</td>
<td align="right">0.0082359</td>
<td align="right">0.0016908</td>
<td align="right">4.8709129</td>
<td align="right">0.0000018</td>
</tr>
<tr class="odd">
<td align="left">alcohol_consumption_rate</td>
<td align="right">-1.6323824</td>
<td align="right">0.5942983</td>
<td align="right">-2.7467389</td>
<td align="right">0.0063817</td>
</tr>
</tbody>
</table>
<p>Results from MLR show that gdp, inflation rate, crime rate, personnel
rate, number of trafficked victims per 100,000 and alcohol consumption
rates are significant predictors of violence rate at significance level
alpha = 0.01.</p>
</div>
<div id="calculate-vif-for-baseline-violence-mlr"
class="section level2">
<h2>Calculate VIF for baseline violence MLR</h2>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gdp</td>
<td align="right">2.396884</td>
</tr>
<tr class="even">
<td align="left">inflation_rate</td>
<td align="right">1.176607</td>
</tr>
<tr class="odd">
<td align="left">unemployment_rate</td>
<td align="right">1.164411</td>
</tr>
<tr class="even">
<td align="left">hdi</td>
<td align="right">2.455203</td>
</tr>
<tr class="odd">
<td align="left">crime_rate</td>
<td align="right">1.700020</td>
</tr>
<tr class="even">
<td align="left">personnel_rate</td>
<td align="right">1.306548</td>
</tr>
<tr class="odd">
<td align="left">trafficked_victims</td>
<td align="right">2.315171</td>
</tr>
<tr class="even">
<td align="left">alcohol_consumption_rate</td>
<td align="right">1.896571</td>
</tr>
</tbody>
</table>
<p>Results from VIF show that there is no multicollinearity issue (VIF
&lt; 5).</p>
</div>
</div>
<div id="lasso" class="section level1">
<h1>Lasso</h1>
<p>We used Lasso to as a feature selection tool to find the most
important variables in predicting homicide rate and violence rate.</p>
<div id="predictors-for-violence-rate" class="section level2">
<h2>Predictors for violence rate:</h2>
<p>To prepare data for Lasso (fitting violence rate), we removed
variables that are not predictors including iso3_code, country, region,
year and homicide rate. We then dropped NA values before performing
Lasso.</p>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">step</th>
<th align="right">estimate</th>
<th align="right">lambda</th>
<th align="right">dev.ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">1</td>
<td align="right">29.5432748</td>
<td align="right">0.7943282</td>
<td align="right">0.5165853</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">1</td>
<td align="right">0.0000000</td>
<td align="right">0.7943282</td>
<td align="right">0.5165853</td>
</tr>
<tr class="odd">
<td align="left">inflation_rate</td>
<td align="right">1</td>
<td align="right">-1.5694059</td>
<td align="right">0.7943282</td>
<td align="right">0.5165853</td>
</tr>
<tr class="even">
<td align="left">crime_rate</td>
<td align="right">1</td>
<td align="right">0.1088544</td>
<td align="right">0.7943282</td>
<td align="right">0.5165853</td>
</tr>
<tr class="odd">
<td align="left">personnel_rate</td>
<td align="right">1</td>
<td align="right">-0.0473156</td>
<td align="right">0.7943282</td>
<td align="right">0.5165853</td>
</tr>
<tr class="even">
<td align="left">trafficked_victims</td>
<td align="right">1</td>
<td align="right">0.0078378</td>
<td align="right">0.7943282</td>
<td align="right">0.5165853</td>
</tr>
<tr class="odd">
<td align="left">alcohol_consumption_rate</td>
<td align="right">1</td>
<td align="right">-1.3407173</td>
<td align="right">0.7943282</td>
<td align="right">0.5165853</td>
</tr>
</tbody>
</table>
<p>The optimal lambda for violence rate is 0.794. Based on lasso
estimates, the coefficient for <code>gdp</code> was shrunk to 0.</p>
</div>
<div id="predictors-for-homicide-rate." class="section level2">
<h2>Predictors for homicide rate.</h2>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">step</th>
<th align="right">estimate</th>
<th align="right">lambda</th>
<th align="right">dev.ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">1</td>
<td align="right">75.5833480</td>
<td align="right">0.0630957</td>
<td align="right">0.3524531</td>
</tr>
<tr class="even">
<td align="left">gdp</td>
<td align="right">1</td>
<td align="right">0.0000000</td>
<td align="right">0.0630957</td>
<td align="right">0.3524531</td>
</tr>
<tr class="odd">
<td align="left">inflation_rate</td>
<td align="right">1</td>
<td align="right">-0.6907875</td>
<td align="right">0.0630957</td>
<td align="right">0.3524531</td>
</tr>
<tr class="even">
<td align="left">unemployment_rate</td>
<td align="right">1</td>
<td align="right">-0.3553263</td>
<td align="right">0.0630957</td>
<td align="right">0.3524531</td>
</tr>
<tr class="odd">
<td align="left">hdi</td>
<td align="right">1</td>
<td align="right">-78.2143914</td>
<td align="right">0.0630957</td>
<td align="right">0.3524531</td>
</tr>
<tr class="even">
<td align="left">crime_rate</td>
<td align="right">1</td>
<td align="right">0.0043479</td>
<td align="right">0.0630957</td>
<td align="right">0.3524531</td>
</tr>
<tr class="odd">
<td align="left">personnel_rate</td>
<td align="right">1</td>
<td align="right">0.0085533</td>
<td align="right">0.0630957</td>
<td align="right">0.3524531</td>
</tr>
<tr class="even">
<td align="left">trafficked_victims</td>
<td align="right">1</td>
<td align="right">-0.0002459</td>
<td align="right">0.0630957</td>
<td align="right">0.3524531</td>
</tr>
<tr class="odd">
<td align="left">alcohol_consumption_rate</td>
<td align="right">1</td>
<td align="right">-0.2056343</td>
<td align="right">0.0630957</td>
<td align="right">0.3524531</td>
</tr>
</tbody>
</table>
<p>The optimal lambda for homicide rate is 0.050. Similar to the results
from violence, the coefficient for <code>gdp</code> was shrunk to 0.</p>
</div>
</div>
<div id="criterion-based-procedure" class="section level1">
<h1>Criterion-based procedure</h1>
<div id="best-subset-regression-for-violence-rate"
class="section level2">
<h2>Best Subset Regression for Violence Rate</h2>
<div id="predict-violence-rate-using-r-squared-as-criterion"
class="section level3">
<h3>Predict violence rate using r-squared as criterion</h3>
<pre><code>## $Criterion
## [1] 0.5103599
## 
## $Variable_Selection
##                      gdp           inflation_rate        unemployment_rate 
##                     TRUE                     TRUE                    FALSE 
##                      hdi               crime_rate           personnel_rate 
##                    FALSE                     TRUE                     TRUE 
##       trafficked_victims alcohol_consumption_rate 
##                     TRUE                     TRUE</code></pre>
</div>
<div id="predict-violence_rate-using-cp-as-criterion"
class="section level3">
<h3>Predict violence_rate using Cp as criterion</h3>
<pre><code>## $Criterion
## [1] 5.363491
## 
## $Variable_Selection
##                      gdp           inflation_rate        unemployment_rate 
##                     TRUE                     TRUE                    FALSE 
##                      hdi               crime_rate           personnel_rate 
##                    FALSE                     TRUE                     TRUE 
##       trafficked_victims alcohol_consumption_rate 
##                     TRUE                     TRUE</code></pre>
</div>
<div id="check-for-co-linearity-in-best-subset-violence-model"
class="section level3">
<h3>Check for co-linearity in best subset violence model</h3>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gdp</td>
<td align="right">2.346184</td>
</tr>
<tr class="even">
<td align="left">inflation_rate</td>
<td align="right">1.070415</td>
</tr>
<tr class="odd">
<td align="left">crime_rate</td>
<td align="right">1.373276</td>
</tr>
<tr class="even">
<td align="left">personnel_rate</td>
<td align="right">1.240083</td>
</tr>
<tr class="odd">
<td align="left">trafficked_victims</td>
<td align="right">2.282920</td>
</tr>
<tr class="even">
<td align="left">alcohol_consumption_rate</td>
<td align="right">1.168675</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="best-subset-regression-for-homicide-rate"
class="section level2">
<h2>Best subset regression for Homicide Rate</h2>
<div id="predict-homicide-rate-using-r-squared-as-criterion"
class="section level3">
<h3>Predict homicide rate using R-squared as criterion</h3>
<pre><code>## $Criterion
## [1] 0.3367418
## 
## $Variable_Selection
##                      gdp           inflation_rate        unemployment_rate 
##                     TRUE                     TRUE                     TRUE 
##                      hdi               crime_rate           personnel_rate 
##                     TRUE                     TRUE                     TRUE 
##       trafficked_victims alcohol_consumption_rate 
##                    FALSE                     TRUE</code></pre>
</div>
<div id="predict-homicide-rates-using-cp-as-criterion"
class="section level3">
<h3>Predict Homicide Rates using Cp as criterion</h3>
<pre><code>## $Criterion
## [1] 6.511243
## 
## $Variable_Selection
##                      gdp           inflation_rate        unemployment_rate 
##                    FALSE                     TRUE                     TRUE 
##                      hdi               crime_rate           personnel_rate 
##                     TRUE                     TRUE                    FALSE 
##       trafficked_victims alcohol_consumption_rate 
##                    FALSE                    FALSE</code></pre>
</div>
<div id="check-for-co-linearity-in-best-subset-homicide-model"
class="section level3">
<h3>Check for co-linearity in best subset homicide model</h3>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">inflation_rate</td>
<td align="right">1.169288</td>
</tr>
<tr class="even">
<td align="left">unemployment_rate</td>
<td align="right">1.034265</td>
</tr>
<tr class="odd">
<td align="left">hdi</td>
<td align="right">1.468355</td>
</tr>
<tr class="even">
<td align="left">crime_rate</td>
<td align="right">1.316883</td>
</tr>
</tbody>
</table>
<p>The results from criterion-based procedures suggest that significant
predictors for violence_rate are gdp, inflation_rate, crime_rate,
personnel_rate, trafficked_victims and alcohol_consumption rate, with a
total of 6 predictors. This yields the most appropriate Cp value
(5.363), which is approximately close to the number of predictors, and
highest adjusted R-squared (0.510).</p>
<p>For homicide_rate, the results are not as straightforward. The best
model based on Cp and R-squared seems to be the model with 4 predictors
because it has the lowest Cp (6.36), and a decently high adjusted
R-squared (0.331), indicating a good balance between fit and complexity.
As more predictors are added, R-squared adjusts slightly but Cp levels
off at around 6 predictors. The model with 4 predictors, which includes
inflation_rate, unemployment_rate, hdi, personnel_rate, seems to be a
better trade-off.</p>
</div>
</div>
</div>
<div id="model-comparison" class="section level1">
<h1>Model Comparison</h1>
<div id="create-training-and-testing-datasets" class="section level2">
<h2>Create Training and Testing Datasets</h2>
<pre class="r"><code>cv_df_violence &lt;- 
  modelr::crossv_mc(violence_df, 100)

cv_df_violence &lt;- cv_df_violence %&gt;% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )

cv_df_homicide &lt;-
  modelr::crossv_mc(homicide_df, 100)

cv_df_homicide &lt;- cv_df_homicide %&gt;% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )</code></pre>
</div>
<div id="fit-models" class="section level2">
<h2>Fit Models</h2>
<div id="violence" class="section level3">
<h3>Violence</h3>
<pre class="r"><code>cv_df_violence &lt;-
  cv_df_violence %&gt;% 
  mutate(
    MLR_all_var = map(train, \(df) lm(violence_rate ~ ., data = df)),
    MLR_best_subset = map(train, \(df) lm(violence_rate ~ gdp + inflation_rate + 
                           crime_rate + personnel_rate + trafficked_victims +
                           alcohol_consumption_rate, data = df)),
    lasso = map(train, \(df) fit_glmnet(df, outcome = &quot;violence_rate&quot;, 
                                        alpha = 1,lambda = lambda))
  ) %&gt;% 
  mutate(
    rmse_all_var = map2_dbl(
      MLR_all_var, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_best_subset = map2_dbl(
      MLR_best_subset, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_lasso = map2_dbl(
      lasso, test, \(mod, test) rmse_glmnet(mod, test, &quot;violence_rate&quot;))
  ) %&gt;% 
  dplyr::select(starts_with(&quot;rmse_&quot;))</code></pre>
</div>
<div id="homicide" class="section level3">
<h3>Homicide</h3>
<pre class="r"><code>cv_df_homicide &lt;-
  cv_df_homicide %&gt;% 
  mutate(
    MLR_all_var = map(train, \(df) lm(homicide_rate ~ ., data = df)),
    MLR_best_subset = map(train, \(df) lm(homicide_rate ~ inflation_rate 
                          + unemployment_rate + hdi + crime_rate, data = df)),
    lasso = map(train, \(df) fit_glmnet(df, outcome = &quot;homicide_rate&quot;, 
                                        alpha = 1,lambda = lambda))
  ) %&gt;% 
  mutate(
    rmse_all_var = map2_dbl(
      MLR_all_var, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_best_subset = map2_dbl(
      MLR_best_subset, test, \(mod, test) rmse(model = mod, data = test)),
    rmse_lasso = map2_dbl(
      lasso, test, \(mod, test) rmse_glmnet(mod, test, &quot;homicide_rate&quot;))
  ) %&gt;% 
  dplyr::select(starts_with(&quot;rmse_&quot;))</code></pre>
</div>
</div>
<div id="compare-rmse" class="section level2">
<h2>Compare RMSE</h2>
<div id="violence-1" class="section level3">
<h3>Violence</h3>
<p><img src="regression_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="homicide-1" class="section level3">
<h3>Homicide</h3>
<p><img src="regression_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
