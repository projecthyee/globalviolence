---
title: "EDA"
author: "Jeffrey Lin"
date: "2024-11-13"
output: html_document
---

# Load Libraries
```{r}
library(tidyverse)
library(readxl)
library(rlang)
library(patchwork)

```


# Data Pre-Processing 

## Examine Merged Violence Dataframe
```{r}
head(merged_violence_df)
```


## Create Separate Dataframe for Variables of Interest

```{r}

EDA_var_interest <- merged_violence_df %>% 
  mutate(development_status = factor(case_when(
    hdi < 0.550 ~ "low",
    hdi >= 0.550 & hdi < 0.700 ~ "medium",
    hdi >= 0.700 & hdi < 0.800 ~ "high",
    hdi >= 0.800 ~ "very high"
    ))
  )  

head(EDA_var_interest)

var_names <- EDA_var_interest %>% 
  dplyr::select(c(hdi:alcohol_consumption_rate)) %>% 
  colnames() 

```

## Generalized Plotting Function
```{r}
make_plot = function(data, geom_type, title, grouping = NULL, ...) {
  plt <- data %>% 
    ggplot(aes(...)) +
    geom_type() + 
    ggtitle(title) +
    theme(plot.title = element_text(hjust = 0.5))
  
  if (!is.null(grouping)) {
    grouping = sym(grouping)
    plt <- plt + facet_grid(as.formula(paste("~", grouping)))
  }
  
  return(plt)
  
}

```

# Scatter Plots

## Global

### Outcome Variable: homicide Rate
```{r}

map(var_names, \(x) make_plot(EDA_var_interest, geom_point, 
    str_c("Homicide Rate by ", x), x = .data[[x]], y = homicide_rate
    ))

```


### Outcome Variable: Average Violence Rate
```{r}
map(var_names, \(x) make_plot(EDA_var_interest, geom_point, 
    str_c("Average Violence Rate by ", x), x = .data[[x]], y = violence_rate
    ))

```


## Regional


### Outcome Variable: Average Violence Rate
```{r}
map(var_names, \(x) make_plot(EDA_var_interest, geom_point,
    str_c("Average Violence Rate by ", x, " and Region"), "region", 
    x = .data[[x]], y = violence_rate, color = region)
    )

```
### Outcome Variable: Homocide Rate

```{r}
map(var_names, \(x) make_plot(EDA_var_interest, geom_point,
    str_c("Homicide Rate by ", x, " and Region"), "region", 
    x = .data[[x]], y = homicide_rate, color = region)
    )

```

# Density Plots 

## Distribution of Variables of Interest by Region
```{r}
map(var_names, \(x) make_plot(EDA_var_interest, geom_density, 
    str_c("Distribution of ", x, " based on Region"), "region",
    x = .data[[x]], color = region))

```

## Distribution of Variables of Interest by Development Status
```{r}
map(var_names, \(x) make_plot(EDA_var_interest, geom_density, 
    str_c("Distribution of ", x, " based on Development Status"), "development_status",
    x = .data[[x]], color = development_status))
```


## Regional 

## by HDI




# Bar Charts

## Count of Development Statuses 

```{r}

EDA_var_interest %>% 
  drop_na(development_status) %>% 
  make_plot(geom_bar, "Distribution of Development Status",
            x = development_status, fill = development_status)

```

# Box Plots

## Average Violence Rate by Development Status
```{r}
EDA_var_interest %>% 
  drop_na(development_status) %>% 
  make_plot(geom_boxplot, title = "Average Violence Rate by Development Status", 
            x = development_status, y = violence_rate)

```
## Homicide Rate
```{r}
EDA_var_interest %>% 
  drop_na(development_status) %>% 
  make_plot(geom_boxplot, title = "Homicide Rate by Development Status", 
            x = development_status, y = homicide_rate)


```




# Old Code

##  Global

### Visualize Distribution
```{r}
merged_violence_df %>% 
  ggplot(aes(x = hdi)) +
  geom_density() +
  xlab("Human Development Index") + 
  ylab("Density") +
  ggtitle("Distribution of Global HDI Scores") +
  theme(plot.title = element_text(hjust = 0.5))

```

### Box Cox Transformation
```{r}
merged_violence_df <- merged_violence_df %>%
  mutate(
    hdi = hdi + 0.0001
  )

HDI <- merged_violence_df %>% 
  pull(hdi)

box_cox_MLE <- as.data.frame(MASS::boxcox(HDI ~ 1)) 

lambda <- box_cox_MLE %>%
  filter(y == max(y)) %>% 
  pull(x)

merged_violence_df <- merged_violence_df %>% 
  mutate(
    box_cox_HDI = (hdi ^ (lambda - 1)) / lambda  
  )

```

Distribution after Box Cox Transformation
```{r}

merged_violence_df %>% 
  ggplot(aes(x = box_cox_HDI)) +
  geom_density() +
  xlab("Box Cox Transformed Human Development Index") + 
  ylab("Density") +
  ggtitle("Distribution of Global HDI Scores") +
  theme(plot.title = element_text(hjust = 0.5))


```
### Scatter plot of HDI against average violence rate
```{r}
merged_violence_df %>% 
  ggplot(aes(x = hdi, violence_rate)) +
  geom_point() +
  xlab("Human Development Index") +
  ylab("Average Violence Rate") +
  ggtitle("Average Rate of Violence by Human Development Index") +
  theme(plot.title = element_text(hjust = 0.5))
```


### Scatter plot of HDI against homicide rate
```{r}
merged_violence_df %>% 
  ggplot(aes(x = hdi, homicide_rate)) +
  geom_point() +
  xlab("Human Development Index") +
  ylab("Homicide Rate") +
  ggtitle("Homicide Rate by Human Development Index") +
  theme(plot.title = element_text(hjust = 0.5))

```

## By Region

### Distribution of HDI by Region

```{r}
merged_violence_df %>% 
  ggplot(aes(x = hdi, color = region)) +
  geom_density() +
  facet_grid(.~region) +
  xlab("Human Development Index") + 
  ylab("Density") +
  ggtitle("Distribution of HDI Scores by Region") +
  theme(plot.title = element_text(hjust = 0.5))

```
### Distribution of HDI by Region with box cox transformation

```{r}
merged_violence_df %>% 
  ggplot(aes(x = box_cox_HDI, color = region)) +
  geom_density() +
  facet_grid(.~region) +
  xlab("Box Cox Transformed Human Development Index") + 
  ylab("Density") +
  ggtitle("Distribution of HDI Scores by Region") +
  theme(plot.title = element_text(hjust = 0.5))


```

### Scatter plot of HDI against average violence rate
```{r}
merged_violence_df %>% 
  ggplot(aes(x = hdi, violence_rate, color = region)) +
  geom_point() +
  facet_grid(.~region) +
  xlab("Human Development Index") +
  ylab("Average Violence Rate") +
  ggtitle("Average Rate of Violence by Human Development Index") +
  theme(plot.title = element_text(hjust = 0.5))
```
### Scatter plot of HDI against homicide rate
```{r}
merged_violence_df %>% 
  ggplot(aes(x = hdi, homicide_rate, color = region)) +
  geom_point() +
  facet_grid(.~region) +
  xlab("Human Development Index") +
  ylab("Homicide Rate") +
  ggtitle("Homicide Rate by Human Development Index") +
  theme(plot.title = element_text(hjust = 0.5))

```

## By Development Status

### Add Development Variable

```{r}
merged_violence_df <- merged_violence_df %>% 
  mutate(development_status = factor(case_when(
    hdi < 0.550 ~ "low",
    hdi >= 0.550 & hdi < 0.700 ~ "medium",
    hdi >= 0.700 & hdi < 0.800 ~ "high",
    hdi >= 0.800 ~ "very high"
    ))
  )
```

### Distribution of Development Status
```{r}
merged_violence_df %>% 
  drop_na(development_status) %>% 
  ggplot(aes(x = development_status, fill = development_status)) +
  geom_bar() +
  xlab("Development Status") + 
  ggtitle("Distribution of Development Status") + 
  theme(plot.title = element_text(hjust = 0.5))

```


